"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[972],{9498:function(t,e,n){n.d(e,{C:function(){return su},E:function(){return o9},G:function(){return al},H:function(){return ad},K:function(){return aa},L:function(){return ao},M:function(){return b},T:function(){return st},U:function(){return as},W:function(){return ah},Z:function(){return ag},a:function(){return aN},c:function(){return aT},e:function(){return a_},i:function(){return aI},j:function(){return ac},o:function(){return aE},s:function(){return ab},t:function(){return av},u:function(){return aS}});var r=n(655),i=n(4589),o=n(4594),s=n(3705),a=n(7061),u=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();u.o=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var c={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},h=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,r.__extends)(e,t),e}(Error),l=new o.Logger("@firebase/firestore");function f(){return l.logLevel}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=o.LogLevel.DEBUG){var i=e.map(m);l.debug.apply(l,(0,r.__spreadArray)(["Firestore (8.10.1): "+t],i))}}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=o.LogLevel.ERROR){var i=e.map(m);l.error.apply(l,(0,r.__spreadArray)(["Firestore (8.10.1): "+t],i))}}function y(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=o.LogLevel.WARN){var i=e.map(m);l.warn.apply(l,(0,r.__spreadArray)(["Firestore (8.10.1): "+t],i))}}function m(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw p(e),Error(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var v=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function _(t,e){return t<e?-1:t>e?1:0}function w(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var b=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0||e>=1e9)throw new h(c.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800||t>=253402300800)throw new h(c.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?_(this.nanoseconds,t.nanoseconds):_(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),I=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new b(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function T(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function S(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var N=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&g(),void 0===n?n=t.length-e:n>t.length-e&&g(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return -1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0;i<t.length;i++){var o=t[i];if(o.indexOf("//")>=0)throw new h(c.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");r.push.apply(r,o.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(N),A=/^[_a-zA-Z][_a-zA-Z0-9]*$/,x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return A.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new h(c.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new h(c.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new h(c.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new h(c.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(N),k=function(){function t(t){this.fields=t,t.sort(x.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return w(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),C=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return _(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();C.EMPTY_BYTE_STRING=new C("");var R=RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function L(t){if(t||g(),"string"==typeof t){var e=0,n=R.exec(t);if(n||g(),n[1]){var r=n[1];e=Number(r=(r+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(t).getTime()/1e3),nanos:e}}return{seconds:O(t.seconds),nanos:O(t.nanos)}}function O(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function P(t){return"string"==typeof t?C.fromBase64String(t):C.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function M(t){var e=L(t.mapValue.fields.__local_write_time__.timestampValue);return new b(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V(t){return null==t}function q(t){return 0===t&&1/t==-1/0}function U(t){return"number"==typeof t&&Number.isInteger(t)&&!q(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var B=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(D.fromString(e))},t.fromName=function(e){return new t(D.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===D.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return D.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new D(e.slice()))},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?F(t)?4:10:g()}function K(t,e){var n=j(t);if(n!==j(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return M(t).isEqual(M(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=L(t.timestampValue),r=L(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return P(t.bytesValue).isEqual(P(e.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return O(t.geoPointValue.latitude)===O(e.geoPointValue.latitude)&&O(t.geoPointValue.longitude)===O(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return O(t.integerValue)===O(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=O(t.doubleValue),r=O(e.doubleValue);return n===r?q(n)===q(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return w(t.arrayValue.values||[],e.arrayValue.values||[],K);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(E(n)!==E(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!K(n[i],r[i])))return!1;return!0}(t,e);default:return g()}}function Q(t,e){return void 0!==(t.values||[]).find(function(t){return K(t,e)})}function G(t,e){var n,r,i,o,s,a,u,c,h,l=j(t),f=j(e);if(l!==f)return _(l,f);switch(l){case 0:return 0;case 1:return _(t.booleanValue,e.booleanValue);case 2:return(n=O(t.integerValue||t.doubleValue))<(r=O(e.integerValue||e.doubleValue))?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1;case 3:return z(t.timestampValue,e.timestampValue);case 4:return z(M(t),M(e));case 5:return _(t.stringValue,e.stringValue);case 6:return i=t.bytesValue,o=e.bytesValue,s=P(i),a=P(o),s.compareTo(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=_(n[i],r[i]);if(0!==o)return o}return _(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return u=t.geoPointValue,c=e.geoPointValue,0!==(h=_(O(u.latitude),O(c.latitude)))?h:_(O(u.longitude),O(c.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=G(n[i],r[i]);if(o)return o}return _(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=_(r[s],o[s]);if(0!==a)return a;var u=G(n[r[s]],i[o[s]]);if(0!==u)return u}return _(r.length,o.length)}(t.mapValue,e.mapValue);default:throw g()}}function z(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return _(t,e);var n=L(t),r=L(e),i=_(n.seconds,r.seconds);return 0!==i?i:_(n.nanos,r.nanos)}function W(t){var e,n,r;return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?"time("+(r=L(t.timestampValue)).seconds+","+r.nanos+")":"stringValue"in t?t.stringValue:"bytesValue"in t?P(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,B.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=W(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+W(t.fields[o])}return e+"}"}(t.mapValue):g()}function H(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Y(t){return!!t&&"integerValue"in t}function $(t){return!!t&&"arrayValue"in t}function X(t){return!!t&&"nullValue"in t}function J(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Z(t){return!!t&&"mapValue"in t}function tt(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return T(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=tt(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=tt(t.arrayValue.values[r]);return n}return Object.assign({},t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var te=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Z(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=tt(e)},t.prototype.setAll=function(t){var e=this,n=x.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=tt(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Z(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return K(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Z(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){T(e,function(e,n){return t[e]=n});for(var r=0;r<n.length;r++)delete t[n[r]]},t.prototype.clone=function(){return new t(tt(this.value))},t}(),tn=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,I.min(),te.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,te.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,te.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=te.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=te.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),tr=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ti(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new tr(t,e,n,r,i,o,s)}function to(t){var e=t;if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:"+e.filters.map(function(t){return t.field.canonicalString()+t.op.toString()+W(t.value)}).join(",")+"|ob:"+e.orderBy.map(function(t){return t.field.canonicalString()+t.dir}).join(","),V(e.limit)||(n+="|l:"+e.limit),e.startAt&&(n+="|lb:"+tv(e.startAt)),e.endAt&&(n+="|ub:"+tv(e.endAt)),e.h=n}return e.h}function ts(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i,o,s=0;s<t.orderBy.length;s++)if(n=t.orderBy[s],r=e.orderBy[s],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1;if(t.filters.length!==e.filters.length)return!1;for(var a=0;a<t.filters.length;a++)if(i=t.filters[a],o=e.filters[a],i.op!==o.op||!i.field.isEqual(o.field)||!K(i.value,o.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!tb(t.startAt,e.startAt)&&tb(t.endAt,e.endAt)}function ta(t){return B.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var tu=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,r.__extends)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new tc(t,n,r):"array-contains"===n?new td(t,r):"in"===n?new tp(t,r):"not-in"===n?new ty(t,r):"array-contains-any"===n?new tm(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new th(t,n):new tl(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(G(e,this.value)):null!==e&&j(this.value)===j(e)&&this.m(G(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return g()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),tc=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=B.fromName(r.referenceValue),i}return(0,r.__extends)(e,t),e.prototype.matches=function(t){var e=B.comparator(t.key,this.key);return this.m(e)},e}(tu),th=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=tf("in",n),r}return(0,r.__extends)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(tu),tl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=tf("not-in",n),r}return(0,r.__extends)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(tu);function tf(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return B.fromName(t.referenceValue)})}var td=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return(0,r.__extends)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return $(e)&&Q(e.arrayValue,this.value)},e}(tu),tp=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return(0,r.__extends)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Q(this.value.arrayValue,e)},e}(tu),ty=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return(0,r.__extends)(e,t),e.prototype.matches=function(t){if(Q(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Q(this.value.arrayValue,e)},e}(tu),tm=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,r.__extends)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!$(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Q(e.value.arrayValue,t)})},e}(tu),tg=function(t,e){this.position=t,this.before=e};function tv(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return W(t)}).join(",")}var t_=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function tw(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?B.comparator(B.fromName(s.referenceValue),n.key):G(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function tb(t,e){if(null===t)return null===e;if(null===e||t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!K(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tI=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function tE(t){return new tI(t)}function tT(t){return!V(t.limit)&&"F"===t.limitType}function tS(t){return!V(t.limit)&&"L"===t.limitType}function tN(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function tD(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function tA(t){return null!==t.collectionGroup}function tx(t){var e=t;if(null===e.p){e.p=[];var n=tD(e),r=tN(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new t_(n)),e.p.push(new t_(x.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new t_(x.keyField(),u))}}}return e.p}function tk(t){var e=t;if(!e.T){if("F"===e.limitType)e.T=ti(e.path,e.collectionGroup,tx(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=tx(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new t_(o.field,s))}var a=e.endAt?new tg(e.endAt.position,!e.endAt.before):null,u=e.startAt?new tg(e.startAt.position,!e.startAt.before):null;e.T=ti(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}}return e.T}function tC(t,e,n){return new tI(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function tR(t,e){return ts(tk(t),tk(e))&&t.limitType===e.limitType}function tL(t){return to(tk(t))+"|lt:"+t.limitType}function tO(t){var e,n;return"Query(target="+(n=(e=tk(t)).path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=", filters: ["+e.filters.map(function(t){return t.field.canonicalString()+" "+t.op+" "+W(t.value)}).join(", ")+"]"),V(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=", orderBy: ["+e.orderBy.map(function(t){return t.field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+tv(e.startAt)),e.endAt&&(n+=", endAt: "+tv(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")"}function tP(t,e){var n;return e.isFoundDocument()&&(n=e.key.path,null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):B.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n))&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&!(t.startAt&&!tw(t.startAt,tx(t),e))&&(!t.endAt||!tw(t.endAt,tx(t),e))}function tF(t){return function(e,n){for(var r=!1,i=0,o=tx(t);i<o.length;i++){var s=o[i],a=function(t,e,n){var r,i,o,s=t.field.isKeyField()?B.comparator(e.key,n.key):(r=t.field,i=e.data.field(r),o=n.data.field(r),null!==i&&null!==o?G(i,o):g());switch(t.dir){case"asc":return s;case"desc":return -1*s;default:return g()}}(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tM(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:q(e)?"-0":e}}function tV(t){return{integerValue:""+t}}function tq(t,e){return U(e)?tV(e):tM(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var tU=function(){this._=void 0};function tB(t,e){return t instanceof tW?Y(e)||e&&"doubleValue"in e?e:{integerValue:0}:null}var tj=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e}(tU),tK=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,r.__extends)(e,t),e}(tU);function tQ(t,e){for(var n=tY(e),r=function(t){n.some(function(e){return K(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var tG=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,r.__extends)(e,t),e}(tU);function tz(t,e){for(var n=tY(e),r=function(t){n=n.filter(function(e){return!K(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var tW=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,r.__extends)(e,t),e}(tU);function tH(t){return O(t.integerValue||t.doubleValue)}function tY(t){return $(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var t$=function(t,e){this.field=t,this.transform=e},tX=function(t,e){this.version=t,this.transformResults=e},tJ=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function tZ(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var t0=function(){};function t1(t,e,n){t instanceof t3?function(t,e,n){if(tZ(t.precondition,e)){var r=t.value.clone(),i=t7(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(t4(e),r).setHasLocalMutations()}}(t,e,n):t instanceof t5?function(t,e,n){if(tZ(t.precondition,e)){var r=t7(t.fieldTransforms,n,e),i=e.data;i.setAll(t6(t)),i.setAll(r),e.convertToFoundDocument(t4(e),i).setHasLocalMutations()}}(t,e,n):tZ(t.precondition,e)&&e.convertToNoDocument(I.min())}function t2(t,e){var n,r;return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&w(n,r,function(t,e){var n,r;return t.field.isEqual(e.field)&&(n=t.transform,r=e.transform,n instanceof tK&&r instanceof tK||n instanceof tG&&r instanceof tG?w(n.elements,r.elements,K):n instanceof tW&&r instanceof tW?K(n.A,r.A):n instanceof tj&&r instanceof tj)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function t4(t){return t.isFoundDocument()?t.version:I.min()}var t3=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,r.__extends)(e,t),e}(t0),t5=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,r.__extends)(e,t),e}(t0);function t6(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function t8(t,e,n){var r=new Map;t.length===n.length||g();for(var i=0;i<n.length;i++){var o,s=t[i],a=s.transform,u=e.data.field(s.field);r.set(s.field,(o=n[i],a instanceof tK?tQ(a,u):a instanceof tG?tz(a,u):o))}return r}function t7(t,e,n){for(var r=new Map,i=0;i<t.length;i++){var o=t[i],s=o.transform,a=n.data.field(o.field);r.set(o.field,function(t,e,n){var r,i,o;return t instanceof tj?(r={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},e&&(r.fields.__previous_value__=e),{mapValue:r}):t instanceof tK?tQ(t,e):t instanceof tG?tz(t,e):(o=tH(i=tB(t,e))+tH(t.A),Y(i)&&Y(t.A)?tV(o):tM(t.R,o))}(s,a,e))}return r}var t9,et,ee=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,r.__extends)(e,t),e}(t0),en=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,r.__extends)(e,t),e}(t0),er=function(t){this.count=t};function ei(t){switch(t){case c.OK:return g();case c.CANCELLED:case c.UNKNOWN:case c.DEADLINE_EXCEEDED:case c.RESOURCE_EXHAUSTED:case c.INTERNAL:case c.UNAVAILABLE:case c.UNAUTHENTICATED:return!1;case c.INVALID_ARGUMENT:case c.NOT_FOUND:case c.ALREADY_EXISTS:case c.PERMISSION_DENIED:case c.FAILED_PRECONDITION:case c.ABORTED:case c.OUT_OF_RANGE:case c.UNIMPLEMENTED:case c.DATA_LOSS:return!0;default:return g()}}function eo(t){if(void 0===t)return p("GRPC error has no .code"),c.UNKNOWN;switch(t){case t9.OK:return c.OK;case t9.CANCELLED:return c.CANCELLED;case t9.UNKNOWN:return c.UNKNOWN;case t9.DEADLINE_EXCEEDED:return c.DEADLINE_EXCEEDED;case t9.RESOURCE_EXHAUSTED:return c.RESOURCE_EXHAUSTED;case t9.INTERNAL:return c.INTERNAL;case t9.UNAVAILABLE:return c.UNAVAILABLE;case t9.UNAUTHENTICATED:return c.UNAUTHENTICATED;case t9.INVALID_ARGUMENT:return c.INVALID_ARGUMENT;case t9.NOT_FOUND:return c.NOT_FOUND;case t9.ALREADY_EXISTS:return c.ALREADY_EXISTS;case t9.PERMISSION_DENIED:return c.PERMISSION_DENIED;case t9.FAILED_PRECONDITION:return c.FAILED_PRECONDITION;case t9.ABORTED:return c.ABORTED;case t9.OUT_OF_RANGE:return c.OUT_OF_RANGE;case t9.UNIMPLEMENTED:return c.UNIMPLEMENTED;case t9.DATA_LOSS:return c.DATA_LOSS;default:return g()}}(et=t9||(t9={}))[et.OK=0]="OK",et[et.CANCELLED=1]="CANCELLED",et[et.UNKNOWN=2]="UNKNOWN",et[et.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",et[et.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",et[et.NOT_FOUND=5]="NOT_FOUND",et[et.ALREADY_EXISTS=6]="ALREADY_EXISTS",et[et.PERMISSION_DENIED=7]="PERMISSION_DENIED",et[et.UNAUTHENTICATED=16]="UNAUTHENTICATED",et[et.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",et[et.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",et[et.ABORTED=10]="ABORTED",et[et.OUT_OF_RANGE=11]="OUT_OF_RANGE",et[et.UNIMPLEMENTED=12]="UNIMPLEMENTED",et[et.INTERNAL=13]="INTERNAL",et[et.UNAVAILABLE=14]="UNAVAILABLE",et[et.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var es=function(){function t(t,e){this.comparator=t,this.root=e||eu.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,eu.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,eu.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return -1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ea(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ea(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ea(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ea(this.root,t,this.comparator,!0)},t}(),ea=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),eu=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(0>n(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){return Math.pow(2,this.check())<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw g();var t=this.left.check();if(t!==this.right.check())throw g();return t+(this.isRed()?0:1)},t}();eu.EMPTY=null,eu.RED=!0,eu.BLACK=!1,eu.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw g()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw g()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw g()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw g()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw g()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new eu(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ec=function(){function t(t){this.comparator=t,this.data=new es(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new eh(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new eh(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t)||this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),eh=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),el=new es(B.comparator),ef=new es(B.comparator),ed=new es(B.comparator),ep=new ec(B.comparator);function ey(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ep,r=0;r<t.length;r++){var i=t[r];n=n.add(i)}return n}var em=new ec(_),eg=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ev.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(I.min(),r,em,el,ey())},t}(),ev=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(C.EMPTY_BYTE_STRING,n,ey(),ey(),ey())},t}(),e_=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ew=function(t,e){this.targetId=t,this.V=e},eb=function(t,e,n,r){void 0===n&&(n=C.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},eI=function(){function t(){this.S=0,this.D=eS(),this.C=C.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=ey(),e=ey(),n=ey();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:g()}}),new ev(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=eS()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),eE=function(){function t(t){this.W=t,this.G=new Map,this.H=el,this.J=eT(),this.Y=new ec(_)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:g()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(ta(i)){if(0===n){var o=new B(i.path);this.tt(e,o,tn.newNoDocument(o,I.min()))}else 1===n||g()}else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&ta(o.target)){var s=new B(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,tn.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=ey();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new eg(t,n,this.Y,this.H,r);return this.H=el,this.J=eT(),this.Y=new ec(_),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new eI,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ec(_),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||d("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new eI),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function eT(){return new es(B.comparator)}function eS(){return new es(B.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eN={asc:"ASCENDING",desc:"DESCENDING"},eD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eA=function(t,e){this.databaseId=t,this.I=e};function ex(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ek(t,e){return t.I?e.toBase64():e.toUint8Array()}function eC(t){var e;return t||g(),I.fromTimestamp((e=L(t),new b(e.seconds,e.nanos)))}function eR(t,e){return new D(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function eL(t){var e=D.fromString(t);return eX(e)||g(),e}function eO(t,e){return eR(t.databaseId,e.path)}function eP(t,e){var n=eL(e);if(n.get(1)!==t.databaseId.projectId)throw new h(c.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new h(c.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new B(eq(n))}function eF(t,e){return eR(t.databaseId,e)}function eM(t){var e=eL(t);return 4===e.length?D.emptyPath():eq(e)}function eV(t){return new D(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function eq(t){return t.length>4&&"documents"===t.get(4)||g(),t.popFirst(5)}function eU(t,e,n){return{name:eO(t,e),fields:n.value.mapValue.fields}}function eB(t,e,n){var r=eP(t,e.name),i=eC(e.updateTime),o=new te({mapValue:{fields:e.fields}}),s=tn.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function ej(t,e){var n,r,i,o;if(e instanceof t3)n={update:eU(t,e.key,e.value)};else if(e instanceof ee)n={delete:eO(t,e.key)};else if(e instanceof t5)n={update:eU(t,e.key,e.data),updateMask:(i=e.fieldMask,o=[],i.fields.forEach(function(t){return o.push(t.canonicalString())}),{fieldPaths:o})};else{if(!(e instanceof en))return g();n={verify:eO(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof tj)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof tK)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof tG)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof tW)return{fieldPath:e.field.canonicalString(),increment:n.A};throw g()}(0,t)})),e.precondition.isNone||(n.currentDocument=void 0!==(r=e.precondition).updateTime?{updateTime:ex(t,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:g()),n}function eK(t,e){var n=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?tJ.updateTime(eC(s.updateTime)):void 0!==s.exists?tJ.exists(s.exists):tJ.none():tJ.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;if("setToServerValue"in e)"REQUEST_TIME"===e.setToServerValue||g(),n=new tj;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new tK(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new tG(i)}else"increment"in e?n=new tW(t,e.increment):g();var o=x.fromServerFormat(e.fieldPath);return new t$(o,n)}(t,e)}):[];if(e.update){e.update.name;var i=eP(t,e.update.name),o=new te({mapValue:{fields:e.update.fields}});if(e.updateMask){var s,a,u=(a=e.updateMask.fieldPaths||[],new k(a.map(function(t){return x.fromServerFormat(t)})));return new t5(i,o,u,n,r)}return new t3(i,o,n,r)}if(e.delete){var c=eP(t,e.delete);return new ee(c,n)}if(e.verify){var h=eP(t,e.verify);return new en(h,n)}return g()}function eQ(t,e){return{documents:[eF(t,e.path)]}}function eG(t,e){var n,r={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(r.parent=eF(t,i),r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r.parent=eF(t,i.popLast()),r.structuredQuery.from=[{collectionId:i.lastSegment()}]);var o=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(J(t.value))return{unaryFilter:{field:eY(t.field),op:"IS_NAN"}};if(X(t.value))return{unaryFilter:{field:eY(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(J(t.value))return{unaryFilter:{field:eY(t.field),op:"IS_NOT_NAN"}};if(X(t.value))return{unaryFilter:{field:eY(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:eY(t.field),op:eD[t.op],value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);o&&(r.structuredQuery.where=o);var s=function(t){if(0!==t.length)return t.map(function(t){return{field:eY(t.field),direction:eN[t.dir]}})}(e.orderBy);s&&(r.structuredQuery.orderBy=s);var a=(n=e.limit,t.I||V(n)?n:{value:n});return null!==a&&(r.structuredQuery.limit=a),e.startAt&&(r.structuredQuery.startAt=eW(e.startAt)),e.endAt&&(r.structuredQuery.endAt=eW(e.endAt)),r}function ez(t){var e,n,r,i,o,s,a,u,c,h=eM(t.parent),l=t.structuredQuery,f=l.from?l.from.length:0,d=null;if(f>0){1===f||g();var p=l.from[0];p.allDescendants?d=p.collectionId:h=h.child(p.collectionId)}var y=[];l.where&&(y=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=e$(t.unaryFilter.field);return tu.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=e$(t.unaryFilter.field);return tu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=e$(t.unaryFilter.field);return tu.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=e$(t.unaryFilter.field);return tu.create(i,"!=",{nullValue:"NULL_VALUE"});default:return g()}}(e)]:void 0!==e.fieldFilter?[tu.create(e$(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return g()}}(e.fieldFilter.op),e.fieldFilter.value)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(e){return t(e)}).reduce(function(t,e){return t.concat(e)}):g():[]}(l.where));var m=[];l.orderBy&&(m=l.orderBy.map(function(t){return new t_(e$(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}));var v=null;l.limit&&(v=V(n="object"==typeof(e=l.limit)?e.value:e)?null:n);var _=null;l.startAt&&(_=eH(l.startAt));var w=null;return l.endAt&&(w=eH(l.endAt)),r=h,i=d,o=m,s=y,a=v,u=_,c=w,new tI(r,i,o,s,a,"F",u,c)}function eW(t){return{before:t.before,values:t.position}}function eH(t){var e=!!t.before,n=t.values||[];return new tg(n,e)}function eY(t){return{fieldPath:t.canonicalString()}}function e$(t){return x.fromServerFormat(t.fieldPath)}function eX(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eJ(t){for(var e,n,r="",i=0;i<t.length;i++)r.length>0&&(r+="\x01\x01"),r=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\x00":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(i),r);return r+"\x01\x01"}function eZ(t){var e=t.length;if(e>=2||g(),2===e)return"\x01"===t.charAt(0)&&"\x01"===t.charAt(1)||g(),D.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&g(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s)+"\x00";break;case"\x11":i+=t.substring(o,s+1);break;default:g()}o=s+2}return new D(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var e0=function(t,e){this.seconds=t,this.nanoseconds=e},e1=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};e1.store="owner",e1.key="owner";var e2=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};e2.store="mutationQueues",e2.keyPath="userId";var e4=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};e4.store="mutations",e4.keyPath="batchId",e4.userMutationsIndex="userMutationsIndex",e4.userMutationsKeyPath=["userId","batchId"];var e3=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,eJ(e)]},t.key=function(t,e,n){return[t,eJ(e),n]},t}();e3.store="documentMutations",e3.PLACEHOLDER=new e3;var e5=function(t,e){this.path=t,this.readTime=e},e6=function(t,e){this.path=t,this.version=e},e8=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};e8.store="remoteDocuments",e8.readTimeIndex="readTimeIndex",e8.readTimeIndexPath="readTime",e8.collectionReadTimeIndex="collectionReadTimeIndex",e8.collectionReadTimeIndexPath=["parentPath","readTime"];var e7=function(t){this.byteSize=t};e7.store="remoteDocumentGlobal",e7.key="remoteDocumentGlobalKey";var e9=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};e9.store="targets",e9.keyPath="targetId",e9.queryTargetsIndexName="queryTargetsIndex",e9.queryTargetsKeyPath=["canonicalId","targetId"];var nt=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};nt.store="targetDocuments",nt.keyPath=["targetId","path"],nt.documentTargetsIndex="documentTargetsIndex",nt.documentTargetsKeyPath=["path","targetId"];var ne=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ne.key="targetGlobalKey",ne.store="targetGlobal";var nn=function(t,e){this.collectionId=t,this.parent=e};nn.store="collectionParents",nn.keyPath=["collectionId","parent"];var nr=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};nr.store="clientMetadata",nr.keyPath="clientId";var ni=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ni.store="bundles",ni.keyPath="bundleId";var no=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};no.store="namedQueries",no.keyPath="name";var ns=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__spreadArray)((0,r.__spreadArray)([],[e2.store,e4.store,e3.store,e8.store,e9.store,e1.store,ne.store,nt.store]),[nr.store])),[e7.store])),[nn.store])),[ni.store,no.store]),na="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",nu=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),nc=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},nh=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&g(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0;i<e.length;i++)r(e[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),nl=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new nc,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new np(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=n_(e.target.error);n.ft.reject(new np(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(t){throw new np(n,t)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(d("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new nm(e)},t}(),nf=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t((0,i.getUA)())&&p("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return d("SimpleDb","Removing database:",t),ng(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,i.getUA)(),n=t._t(e),r=t.Et(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<n&&n<10||0<r&&r<4.5)},t.gt=function(){var t;return void 0!==a&&"YES"===(null===(t=a.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(e?e[1].split("_").slice(0,2).join("."):"-1")},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i);return Number(e?e[1].split(".").slice(0,2).join("."):"-1")},t.prototype.At=function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,n=this;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(d("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new np(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new h(c.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new np(t,n))},i.onupgradeneeded=function(t){d("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next(function(){d("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,i){return(0,r.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c;return(0,r.__generator)(this,function(h){switch(h.label){case 0:o="readonly"===e,s=0,a=function(){var e,a,c,h,l;return(0,r.__generator)(this,function(r){switch(r.label){case 0:++s,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=r.sent(),a=i(e=nl.open(u.db,t,o?"readonly":"readwrite",n)).catch(function(t){return e.abort(t),nh.reject(t)}).toPromise(),c={},a.catch(function(){}),[4,e.dt];case 3:return[2,(c.value=(r.sent(),a),c)];case 4:return l="FirebaseError"!==(h=r.sent()).name&&s<3,d("SimpleDb","Transaction failed with error:",h.message,"Retrying:",l),u.close(),l?[3,5]:[2,{value:Promise.reject(h)}];case 5:return[2]}})},u=this,h.label=1;case 1:return[5,a()];case 2:if("object"==typeof(c=h.sent()))return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),nd=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return ng(this.Pt.delete())},t}(),np=function(t){function e(e,n){var r=this;return(r=t.call(this,c.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,r.__extends)(e,t),e}(h);function ny(t){return"IndexedDbTransactionError"===t.name}var nm=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(d("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(d("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ng(n)},t.prototype.add=function(t){return d("SimpleDb","ADD",this.store.name,t,t),ng(this.store.add(t))},t.prototype.get=function(t){var e=this;return ng(this.store.get(t)).next(function(n){return void 0===n&&(n=null),d("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return d("SimpleDb","DELETE",this.store.name,t),ng(this.store.delete(t))},t.prototype.count=function(){return d("SimpleDb","COUNT",this.store.name),ng(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.kt=function(t,e){d("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){e?n=t:(n={},e=t);var n,r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new nh(function(n,r){e.onerror=function(t){r(n_(t.target.error))},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new nh(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new nd(i),s=e(i.primaryKey,i.value,o);if(s instanceof nh){var a=s.catch(function(t){return o.done(),nh.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return nh.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ng(t){return new nh(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){n(n_(t.target.error))}})}var nv=!1;function n_(t){var e=nf._t((0,i.getUA)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new h("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return nv||(nv=!0,setTimeout(function(){throw r},0)),r}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nw=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,r.__extends)(e,t),e}(nu);function nb(t,e){return nf.It(t.Mt,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nI=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&function(t,e,n){var r,i;t instanceof t3?(r=t.value.clone(),i=t8(t.fieldTransforms,e,n.transformResults),r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()):t instanceof t5?function(t,e,n){if(tZ(t.precondition,e)){var r=t8(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(t6(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e,n=0,r=this.baseMutations;n<r.length;n++)(e=r[n]).key.isEqual(t.key)&&t1(e,t,this.localWriteTime);for(var i=0,o=this.mutations;i<o.length;i++)(e=o[i]).key.isEqual(t.key)&&t1(e,t,this.localWriteTime)},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key);e.applyToLocalView(r),r.isValidDocument()||r.convertToNoDocument(I.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ey())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&w(this.mutations,t.mutations,function(t,e){return t2(t,e)})&&w(this.baseMutations,t.baseMutations,function(t,e){return t2(t,e)})},t}(),nE=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){e.mutations.length===r.length||g();for(var i=ed,o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),nT=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=I.min()),void 0===o&&(o=I.min()),void 0===s&&(s=C.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),nS=function(t){this.Lt=t};function nN(t,e){if(e.document)return eB(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=B.fromSegments(e.noDocument.path),r=nC(e.noDocument.readTime),i=tn.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=B.fromSegments(e.unknownDocument.path);return r=nC(e.unknownDocument.version),tn.newUnknownDocument(o,r)}return g()}function nD(t,e,n){var r=nA(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o,s={name:eO(o=t.Lt,e.key),fields:e.data.value.mapValue.fields,updateTime:ex(o,e.version.toTimestamp())},a=e.hasCommittedMutations;return new e8(null,null,s,a,r,i)}if(e.isNoDocument()){var u=e.key.path.toArray(),c=nk(e.version);return a=e.hasCommittedMutations,new e8(null,new e5(u,c),null,a,r,i)}if(e.isUnknownDocument()){var h=e.key.path.toArray(),l=nk(e.version);return new e8(new e6(h,l),null,null,!0,r,i)}return g()}function nA(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function nx(t){var e=new b(t[0],t[1]);return I.fromTimestamp(e)}function nk(t){var e=t.toTimestamp();return new e0(e.seconds,e.nanoseconds)}function nC(t){var e=new b(t.seconds,t.nanoseconds);return I.fromTimestamp(e)}function nR(t,e){for(var n=(e.baseMutations||[]).map(function(e){return eK(t.Lt,e)}),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map(function(e){return eK(t.Lt,e)}),a=b.fromMillis(e.localWriteTimeMs);return new nI(e.batchId,a,n,s)}function nL(t){var e,n,r=nC(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?nC(t.lastLimboFreeSnapshotVersion):I.min();return void 0!==t.query.documents?(1===(n=t.query).documents.length||g(),e=tk(tE(eM(n.documents[0])))):e=tk(ez(t.query)),new nT(e,t.targetId,0,t.lastListenSequenceNumber,r,i,C.fromBase64String(t.resumeToken))}function nO(t,e){var n,r=nk(e.snapshotVersion),i=nk(e.lastLimboFreeSnapshotVersion);n=ta(e.target)?eQ(t.Lt,e.target):eG(t.Lt,e.target);var o=e.resumeToken.toBase64();return new e9(e.targetId,to(e.target),r,o,e.sequenceNumber,i,n)}function nP(t){var e=ez({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?tC(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nF=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return nM(t).get(e).next(function(t){if(t)return{id:t.bundleId,createTime:nC(t.createTime),version:t.version}})},t.prototype.saveBundleMetadata=function(t,e){return nM(t).put({bundleId:e.id,createTime:nk(eC(e.createTime)),version:e.version})},t.prototype.getNamedQuery=function(t,e){return nV(t).get(e).next(function(t){if(t)return{name:t.name,query:nP(t.bundledQuery),readTime:nC(t.readTime)}})},t.prototype.saveNamedQuery=function(t,e){return nV(t).put({name:e.name,readTime:nk(eC(e.readTime)),bundledQuery:e.bundledQuery})},t}();function nM(t){return nb(t,ni.store)}function nV(t){return nb(t,no.store)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nq=function(){function t(){this.Bt=new nU}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),nh.resolve()},t.prototype.getCollectionParents=function(t,e){return nh.resolve(this.Bt.getEntries(e))},t}(),nU=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ec(D.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ec(D.comparator)).toArray()},t}(),nB=function(){function t(){this.qt=new nU}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:eJ(i)};return nj(t).put(o)}return nh.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[e+"\x00",""],!1,!0);return nj(t).Nt(r).next(function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.collectionId!==e)break;n.push(eZ(i.parent))}return n})},t}();function nj(t){return nb(t,nn.store)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nK={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},nQ=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nG(t,e,n){var r=t.store(e4.store),i=t.store(e3.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){1===a||g()}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=e3.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return nh.waitFor(o).next(function(){return c})}function nz(t){var e;if(!t)return 0;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw g();e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */nQ.DEFAULT_COLLECTION_PERCENTILE=10,nQ.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,nQ.DEFAULT=new nQ(41943040,nQ.DEFAULT_COLLECTION_PERCENTILE,nQ.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),nQ.DISABLED=new nQ(-1,0,0);var nW=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return""!==e.uid||g(),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return nY(t).$t({index:e4.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=n$(t),s=nY(t);return s.add({}).next(function(a){"number"==typeof a||g();for(var u,c,h,l,f=new nI(a,e,n,r),d=(u=i.R,c=i.userId,h=f.baseMutations.map(function(t){return ej(u.Lt,t)}),l=f.mutations.map(function(t){return ej(u.Lt,t)}),new e4(c,f.batchId,f.localWriteTime.toMillis(),h,l)),p=[],y=new ec(function(t,e){return _(t.canonicalString(),e.canonicalString())}),m=0;m<r.length;m++){var v=r[m],w=e3.key(i.userId,v.key.path,a);y=y.add(v.key.path.popLast()),p.push(s.put(d)),p.push(o.put(w,e3.PLACEHOLDER))}return y.forEach(function(e){p.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=f.keys()}),nh.waitFor(p).next(function(){return f})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return nY(t).get(e).next(function(t){return t?(t.userId===n.userId||g(),nR(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?nh.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return nY(t).$t({index:e4.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(e.batchId>=r||g(),o=nR(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return nY(t).$t({index:e4.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return nY(t).Nt(e4.userMutationsIndex,n).next(function(t){return t.map(function(t){return nR(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=e3.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return n$(t).$t({range:i},function(r,i,s){var a=r[0],u=r[1],c=r[2],h=eZ(u);if(a===n.userId&&e.path.isEqual(h))return nY(t).get(c).next(function(t){if(!t)throw g();t.userId===n.userId||g(),o.push(nR(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ec(_),i=[];return e.forEach(function(e){var o=e3.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=n$(t).$t({range:s},function(t,i,o){var s=t[0],a=t[1],u=t[2],c=eZ(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(a)}),nh.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=e3.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new ec(_);return n$(t).$t({range:s},function(t,e,o){var s=t[0],u=t[1],c=t[2],h=eZ(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(nY(t).get(e).next(function(t){if(null===t)throw g();t.userId===n.userId||g(),r.push(nR(n.R,t))}))}),nh.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return nG(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),nh.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return nh.resolve();var r=IDBKeyRange.lowerBound(e3.prefixForUser(e.userId)),i=[];return n$(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=eZ(t[1]);i.push(o)}else r.done()}).next(function(){0===i.length||g()})})},t.prototype.containsKey=function(t,e){return nH(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return nX(t).get(this.userId).next(function(t){return t||new e2(e.userId,-1,"")})},t}();function nH(t,e,n){var r=e3.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return n$(t).$t({range:o,Ft:!0},function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()}).next(function(){return s})}function nY(t){return nb(t,e4.store)}function n$(t){return nb(t,e3.store)}function nX(t){return nb(t,e2.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nJ=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),nZ=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new nJ(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return I.fromTimestamp(new b(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return n0(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return e.targetCount>0||g(),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return n0(t).$t(function(s,a){var u=nL(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return nh.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return n0(t).$t(function(t,n){e(nL(n))})},t.prototype.Xt=function(t){return n1(t).get(ne.key).next(function(t){return null!==t||g(),t})},t.prototype.Zt=function(t,e){return n1(t).put(ne.key,e)},t.prototype.te=function(t,e){return n0(t).put(nO(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=to(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return n0(t).$t({range:r,index:e9.queryTargetsIndexName},function(t,n,r){var o=nL(n);ts(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=n2(t);return e.forEach(function(e){var s=eJ(e.path);i.push(o.put(new nt(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),nh.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=n2(t);return nh.forEach(e,function(e){var o=eJ(e.path);return nh.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=n2(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=n2(t),i=ey();return r.$t({range:n,Ft:!0},function(t,e,n){var r=eZ(t[1]),o=new B(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=eJ(e.path),r=IDBKeyRange.bound([n],[n+"\x00"],!1,!0),i=0;return n2(t).$t({index:nt.documentTargetsIndex,Ft:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return n0(t).get(e).next(function(t){return t?nL(t):null})},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n0(t){return nb(t,e9.store)}function n1(t){return nb(t,ne.store)}function n2(t){return nb(t,nt.store)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n4(t){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(e){if(t.code!==c.FAILED_PRECONDITION||t.message!==na)throw t;return d("LocalStore","Unexpectedly lost primary lease"),[2]})})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n3(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=_(n,i);return 0===s?_(r,o):s}var n5=function(){function t(t){this.ne=t,this.buffer=new ec(n3),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();0>n3(e,n)&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),n6=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;d("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return(0,r.__awaiter)(e,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return ny(e=n.sent())?(d("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,n4(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),n8=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return nh.resolve(u.o);var r=new n5(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return -1===this.params.cacheSizeCollectionThreshold?(d("LruGarbageCollector","Garbage collection skipped; disabled"),nh.resolve(nK)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(d("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),nK):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,s,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>h.params.maximumSequenceNumbersToCollect?(d("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),h.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),h.removeTargets(t,n,e)}).next(function(e){return i=e,u=Date.now(),h.removeOrphanedDocuments(t,n)}).next(function(t){return c=Date.now(),f()<=o.LogLevel.DEBUG&&d("LruGarbageCollector","LRU Garbage Collection\n	Counted targets in "+(s-l)+"ms\n	Determined least recently used "+r+" in "+(a-s)+"ms\n	Removed "+i+" targets in "+(u-a)+"ms\n	Removed "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),nh.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),n7=function(){function t(t,e){this.db=t,this.garbageCollector=new n8(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return n9(t,n)},t.prototype.removeReference=function(t,e,n){return n9(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return n9(t,e)},t.prototype._e=function(t,e){var n;return n=!1,nX(t).Ot(function(r){return nH(t,r,e).next(function(t){return t&&(n=!0),nh.resolve(!t)})}).next(function(){return n})},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),n2(t).delete([0,eJ(s.path)])})});i.push(u)}}).next(function(){return nh.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return n9(t,e)},t.prototype.we=function(t,e){var n,r=n2(t),i=u.o;return r.$t({index:nt.documentTargetsIndex},function(t,r){var o=t[0];t[1];var s=r.path,a=r.sequenceNumber;0===o?(i!==u.o&&e(new B(eZ(n)),i),i=a,n=s):i=u.o}).next(function(){i!==u.o&&e(new B(eZ(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function n9(t,e){var n;return n2(t).put((n=t.currentSequenceNumber,new nt(0,eJ(e.path),n)))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rt=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0;r<n.length;r++){var i=n[r],o=i[0],s=i[1];if(this.equalsFn(o,t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){T(this.inner,function(e,n){for(var r=0;r<n.length;r++){var i=n[r];t(i[0],i[1])}})},t.prototype.isEmpty=function(){return S(this.inner)},t}(),re=function(){function t(){this.changes=new rt(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:I.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:tn.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?nh.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),rn=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return ro(t).put(rs(e),n)},t.prototype.removeEntry=function(t,e){var n=ro(t),r=rs(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return ro(t).get(rs(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return ro(t).get(rs(e)).next(function(t){return{document:n.ye(e,t),size:nz(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=el;return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=el,i=new es(B.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,nz(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return nh.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return ro(t).$t({range:r},function(t,e,r){for(var s=B.fromSegments(t);o&&0>B.comparator(o,s);)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=el,o=e.path.length+1,s={};if(n.isEqual(I.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=nA(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=e8.collectionReadTimeIndex}return ro(t).$t(s,function(t,n,s){if(t.length===o){var a=nN(r.R,n);e.path.isPrefixOf(a.key.path)?tP(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new rr(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return ri(t).get(e7.key).next(function(t){return t||g(),t})},t.prototype.me=function(t,e){return ri(t).put(e7.key,e)},t.prototype.ye=function(t,e){if(e){var n=nN(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(I.min()))return n}return tn.newInvalidDocument(t)},t}(),rr=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new rt(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,r.__extends)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ec(function(t,e){return _(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=nD(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast()),r+=nz(u)-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var c=nD(e.Ie.R,tn.newNoDocument(o,I.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,c))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),nh.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(re);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ri(t){return nb(t,e7.store)}function ro(t){return nb(t,e8.store)}function rs(t){return t.path.toArray()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ra=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;n<r&&n>=0&&r<=11||g();var o=new nl("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(e1.store)}(t),t.createObjectStore(e2.store,{keyPath:e2.keyPath}),t.createObjectStore(e4.store,{keyPath:e4.keyPath,autoIncrement:!0}).createIndex(e4.userMutationsIndex,e4.userMutationsKeyPath,{unique:!0}),t.createObjectStore(e3.store),ru(t),function(t){t.createObjectStore(e8.store)}(t));var s=nh.resolve();return n<3&&r>=3&&(0!==n&&(t.deleteObjectStore(nt.store),t.deleteObjectStore(e9.store),t.deleteObjectStore(ne.store),ru(t)),s=s.next(function(){var t,e;return t=o.store(ne.store),e=new ne(0,0,I.min().toTimestamp(),0),t.put(ne.key,e)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return o.store(e4.store).Nt().next(function(e){t.deleteObjectStore(e4.store),t.createObjectStore(e4.store,{keyPath:e4.keyPath,autoIncrement:!0}).createIndex(e4.userMutationsIndex,e4.userMutationsKeyPath,{unique:!0});var n=o.store(e4.store),r=e.map(function(t){return n.put(t)});return nh.waitFor(r)})})),s=s.next(function(){!function(t){t.createObjectStore(nr.store,{keyPath:nr.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(e7.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){var n;t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(n=e.objectStore(e8.store)).createIndex(e8.readTimeIndex,e8.readTimeIndexPath,{unique:!1}),n.createIndex(e8.collectionReadTimeIndex,e8.collectionReadTimeIndexPath,{unique:!1})})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){(function(t){t.createObjectStore(ni.store,{keyPath:ni.keyPath})})(t),function(t){t.createObjectStore(no.store,{keyPath:no.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(e8.store).$t(function(t,n){e+=nz(n)}).next(function(){var n=new e7(e);return t.store(e7.store).put(e7.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(e2.store),r=t.store(e4.store);return n.Nt().next(function(n){return nh.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(e4.userMutationsIndex,i).next(function(r){return nh.forEach(r,function(r){r.userId===n.userId||g();var i=nR(e.R,r);return nG(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(nt.store),n=t.store(e8.store);return t.store(ne.store).get(ne.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new D(n),s=[0,eJ(o)];r.push(e.get(s).next(function(n){return n?nh.resolve():e.put(new nt(0,eJ(o),t.highestListenSequenceNumber))}))}).next(function(){return nh.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(nn.store,{keyPath:nn.keyPath});var n=e.store(nn.store),r=new nU,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:eJ(i)})}};return e.store(e8.store).$t({Ft:!0},function(t,e){return i(new D(t).popLast())}).next(function(){return e.store(e3.store).$t({Ft:!0},function(t,e){t[0];var n=t[1];return t[2],i(eZ(n).popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(e9.store);return n.$t(function(t,r){var i=nL(r),o=nO(e.R,i);return n.put(o)})},t}();function ru(t){t.createObjectStore(nt.store,{keyPath:nt.keyPath}).createIndex(nt.documentTargetsIndex,nt.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(e9.store,{keyPath:e9.keyPath}).createIndex(e9.queryTargetsIndexName,e9.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ne.store)}var rc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",rh=function(){function t(e,n,r,i,o,s,a,u,l,f){var d,y;if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=l,this.Ce=f,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new h(c.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new n7(this,i),this.Le=n+"main",this.R=new nS(u),this.Be=new nf(this.Le,11,new ra(this.R)),this.qe=new nZ(this.referenceDelegate,this.R),this.Ut=new nB,this.Ue=(d=this.R,y=this.Ut,new rn(d,y)),this.Ke=new nF,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===f&&p("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new h(c.FAILED_PRECONDITION,rc);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new u(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return(0,r.__awaiter)(e,void 0,void 0,function(){return(0,r.__generator)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return(0,r.__awaiter)(e,void 0,void 0,function(){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,r.__awaiter)(e,void 0,void 0,function(){return(0,r.__generator)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return rf(e).put(new nr(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(ny(e))return d("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return d("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return rl(t).get(e1.key).next(function(t){return nh.resolve(e.tn(t))})},t.prototype.en=function(t){return rf(t).delete(this.clientId)},t.prototype.nn=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,e,n,i=this;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=nb(t,nr.store);return e.Nt().next(function(t){var n=i.rn(t,18e5),r=t.filter(function(t){return -1===n.indexOf(t)});return nh.forEach(r,function(t){return e.delete(t.clientId)}).next(function(){return r})})}).catch(function(){return[]})]);case 1:if(t=r.sent(),this.Qe)for(e=0;e<t.length;e++)n=t[e],this.Qe.removeItem(this.on(n.clientId));r.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?nh.resolve(!0):rl(t).get(e1.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new h(c.FAILED_PRECONDITION,rc);return!1}}return!(!e.networkEnabled||!e.inForeground)||rf(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&d("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t=this;return(0,r.__generator)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[e1.store,nr.store],function(e){var n=new nw(e,u.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return rf(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return nW.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return d("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",ns,function(o){return r=new nw(o,i.Ne?i.Ne.next():u.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw p("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new h(c.FAILED_PRECONDITION,na);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return rl(t).get(e1.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new h(c.FAILED_PRECONDITION,rc)})},t.prototype.Ze=function(t){var e=new e1(this.clientId,this.allowTabSynchronization,Date.now());return rl(t).put(e1.key,e)},t.yt=function(){return nf.yt()},t.prototype.Xe=function(t){var e=this,n=rl(t);return n.get(e1.key).next(function(t){return e.tn(t)?(d("IndexedDbPersistence","Releasing primary lease."),n.delete(e1.key)):nh.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(p("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),(0,i.isSafari)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return d("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return p("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){p("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function rl(t){return nb(t,e1.store)}function rf(t){return nb(t,nr.store)}function rd(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var rp=function(t,e){this.progress=t,this.wn=e},ry=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0;e<n.length;e++)n[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0;r<e.length;r++)e[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return B.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length?this.Tn(t,e.path):tA(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new B(e)).next(function(t){var e=ef;return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=ef;return this.Ut.getCollectionParents(t,i).next(function(s){return nh.forEach(s,function(s){var a,u=(a=s.child(i),new tI(a,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return r.An(t,u,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,i._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return i.Rn(t,e,r).next(function(t){r=t;for(var n=0;n<e.length;n++)for(var i=e[n],o=0,s=i.mutations;o<s.length;o++){var a=s[o],u=a.key,c=r.get(u);null==c&&(c=tn.newInvalidDocument(u),r=r.insert(u,c)),t1(a,c,i.localWriteTime),c.isFoundDocument()||(r=r.remove(u))}})}).next(function(){return r.forEach(function(t,n){tP(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=ey(),i=0;i<e.length;i++)for(var o=0,s=e[i].mutations;o<s.length;o++){var a=s[o];a instanceof t5&&null===n.get(a.key)&&(r=r.add(a.key))}var u=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(u=u.insert(t,e))}),u})},t}(),rm=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=ey(),i=ey(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),rg=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())||n.isEqual(I.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(s){var a=i.Cn(e,s);return(tT(e)||tS(e))&&i.Nn(e.limitType,a,r,n)?i.Dn(t,e):(f()<=o.LogLevel.DEBUG&&d("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),tO(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return a.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new ec(tF(t));return e.forEach(function(e,r){tP(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return f()<=o.LogLevel.DEBUG&&d("QueryEngine","Using full collection scan to execute query:",tO(e)),this.Sn.getDocumentsMatchingQuery(t,e,I.min())},t}(),rv=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new es(_),this.Fn=new rt(function(t){return to(t)},ts),this.$n=I.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new ry(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.kn)})},t}();function r_(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return i=(n=t)._n,o=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var r;return n._n.getAllMutationBatches(t).next(function(s){return r=s,i=n.persistence.getMutationQueue(e),o=new ry(n.On,i,n.persistence.getIndexManager()),i.getAllMutationBatches(t)}).next(function(e){for(var n=[],i=[],s=ey(),a=0,u=r;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var d=0;d<e.length;d++){var p=e[d];i.push(p.batchId);for(var y=0,m=p.mutations;y<m.length;y++){var g=m[y];s=s.add(g.key)}}return o.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:i}})})})];case 1:return s=r.sent(),[2,(n._n=i,n.Mn=o,n.xn.Vn(n.Mn),s)]}})})}function rw(t){return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.qe.getLastRemoteSnapshotVersion(e)})}function rb(t,e,n,r,i){var o=ey();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=el;return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(I.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):d("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function rI(t,e){var n=t;return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?(r=i,nh.resolve(r)):n.qe.allocateTargetId(t).next(function(i){return r=new nT(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t})}function rE(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:o=(i=t).kn.get(e),s=n?"readwrite":"readwrite-primary",r.label=1;case 1:return r.trys.push([1,4,,5]),n?[3,3]:[4,i.persistence.runTransaction("Release target",s,function(t){return i.persistence.referenceDelegate.removeTarget(t,o)})];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:if(!ny(a=r.sent()))throw a;return d("LocalStore","Failed to update sequence numbers for target "+e+": "+a),[3,5];case 5:return i.kn=i.kn.remove(e),i.Fn.delete(o.target),[2]}})})}function rT(t,e,n){var r=I.min(),i=ey();return t.persistence.runTransaction("Execute query","readonly",function(o){var s,a;return(s=tk(e),void 0!==(a=t.Fn.get(s))?nh.resolve(t.kn.get(a)):t.qe.getTargetData(o,s)).next(function(e){if(e)return r=e.lastLimboFreeSnapshotVersion,t.qe.getMatchingKeysForTargetId(o,e.targetId).next(function(t){i=t})}).next(function(){return t.xn.getDocumentsMatchingQuery(o,e,n?r:I.min(),n?i:ey())}).next(function(t){return{documents:t,Bn:i}})})}function rS(t,e){var n=t.qe,r=t.kn.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",function(t){return n.lt(t,e).next(function(t){return t?t.target:null})})}function rN(t){var e=t;return e.persistence.runTransaction("Get new document changes","readonly",function(t){var n,r,i,o,s,a;return n=e.On,r=e.$n,i=el,o=nA(r),s=ro(t),a=IDBKeyRange.lowerBound(o,!0),s.$t({index:e8.readTimeIndex,range:a},function(t,e){var r=nN(n.R,e);i=i.insert(r.key,r),o=e.readTime}).next(function(){return{wn:i,readTime:nx(o)}})}).then(function(t){var n=t.wn,r=t.readTime;return e.$n=r,n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rD=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return nh.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){return this.Qn.set(e.id,{id:e.id,version:e.version,createTime:eC(e.createTime)}),nh.resolve()},t.prototype.getNamedQuery=function(t,e){return nh.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,{name:e.name,query:nP(e.bundledQuery),readTime:eC(e.readTime)}),nh.resolve()},t}(),rA=function(){function t(){this.Wn=new ec(rx.Gn),this.zn=new ec(rx.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new rx(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new rx(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new B(new D([])),r=new rx(n,t),i=new rx(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new B(new D([])),n=new rx(e,t),r=new rx(e,t+1),i=ey();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new rx(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),rx=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return B.comparator(t.key,e.key)||_(t.ns,e.ns)},t.Hn=function(t,e){return _(t.ns,e.ns)||B.comparator(t.key,e.key)},t}(),rk=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ec(rx.Gn)}return t.prototype.checkEmpty=function(t){return nh.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new nI(i,e,n,r);this._n.push(o);for(var s=0;s<r.length;s++){var a=r[s];this.rs=this.rs.add(new rx(a.key,i)),this.Ut.addToCollectionParentIndex(t,a.key.path.popLast())}return nh.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return nh.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return nh.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return nh.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return nh.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new rx(e,0),i=new rx(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),nh.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ec(_);return e.forEach(function(t){var e=new rx(t,0),i=new rx(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),nh.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;B.isDocumentKey(i)||(i=i.child(""));var o=new rx(new B(i),0),s=new ec(_);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),nh.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;0===this.hs(e.batchId,"removed")||g(),this._n.shift();var r=this.rs;return nh.forEach(e.mutations,function(i){var o=new rx(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new rx(e,0),r=this.rs.firstAfterOrEqual(n);return nh.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,nh.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),rC=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new es(B.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return nh.resolve(n?n.document.clone():tn.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=el;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():tn.newInvalidDocument(t))}),nh.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=el,i=new B(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;0>=h.compareTo(n)||tP(e,c)&&(r=r.insert(c.key,c.clone()))}return nh.resolve(r)},t.prototype.fs=function(t,e){return nh.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new rR(this)},t.prototype.getSize=function(t){return nh.resolve(this.size)},t}(),rR=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,r.__extends)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),nh.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(re),rL=function(){function t(t){this.persistence=t,this.ds=new rt(function(t){return to(t)},ts),this.lastRemoteSnapshotVersion=I.min(),this.highestTargetId=0,this.ws=0,this._s=new rA,this.targetCount=0,this.ys=nJ.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),nh.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return nh.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return nh.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),nh.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),nh.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new nJ(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,nh.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),nh.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,nh.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),nh.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return nh.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return nh.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),nh.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),nh.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),nh.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return nh.resolve(n)},t.prototype.containsKey=function(t,e){return nh.resolve(this._s.containsKey(e))},t}(),rO=function(){function t(t,e){var n,r=this;this.gs={},this.Ne=new u(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new rL(this),this.Ut=new nq,this.Ue=(n=this.Ut,new rC(n,function(t){return r.referenceDelegate.ps(t)})),this.R=new nS(e),this.Ke=new rD(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new rk(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;d("MemoryPersistence","Starting transaction:",t);var i=new rP(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return nh.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),rP=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,r.__extends)(e,t),e}(nu),rF=function(){function t(t){this.persistence=t,this.As=new rA,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw g()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),nh.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),nh.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),nh.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nh.forEach(this.vs,function(r){var i=B.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return nh.or([function(){return nh.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),rM=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rV(t,e){return"firestore_clients_"+t+"_"+e}function rq(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function rU(t,e){return"firestore_targets_"+t+"_"+e}rM.UNAUTHENTICATED=new rM(null),rM.GOOGLE_CREDENTIALS=new rM("google-credentials-uid"),rM.FIRST_PARTY=new rM("first-party-uid"),rM.MOCK_USER=new rM("mock-user");var rB=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new h(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(p("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),rj=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new h(i.error.code,i.error.message)),o?new t(e,i.state,r):(p("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),rK=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=em,s=0;i&&s<r.activeTargetIds.length;++s)i=U(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(p("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),rQ=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(p("SharedClientState","Failed to parse online state: "+e),null)},t}(),rG=function(){function t(){this.activeTargetIds=em}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})},t}(),rz=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new es(_),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=rV(this.persistenceKey,this.Ns),this.Ms="firestore_sequence_number_"+this.persistenceKey,this.Fs=this.Fs.insert(this.Ns,new rG),this.Ls=RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us="firestore_online_state_"+this.persistenceKey,this.Ks="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,e,n,i,o,s,a,u,c,h,l=this;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=r.sent(),e=0;e<t.length;e++)(n=t[e])!==this.Ns&&(i=this.getItem(rV(this.persistenceKey,n)))&&(o=rK.Vs(n,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)h=c[u],this.ks(h);return this.$s=[],this.window.addEventListener("pagehide",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(rU(this.persistenceKey,t));if(n){var r=rj.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(rU(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return d("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){d("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){d("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this;if(t.storageArea===this.storage){if(d("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Os)return void p("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,r.__awaiter)(e,void 0,void 0,function(){var e,n,i,o,s,a;return(0,r.__generator)(this,function(r){if(this.started){if(null!==t.key){if(this.Ls.test(t.key)){if(null==t.newValue)return e=this.ti(t.key),[2,this.ei(e,null)];if(n=this.ni(t.key,t.newValue))return[2,this.ei(n.clientId,n)]}else if(this.Bs.test(t.key)){if(null!==t.newValue&&(i=this.si(t.key,t.newValue)))return[2,this.ii(i)]}else if(this.qs.test(t.key)){if(null!==t.newValue&&(o=this.ri(t.key,t.newValue)))return[2,this.oi(o)]}else if(t.key===this.Us){if(null!==t.newValue&&(s=this.js(t.newValue)))return[2,this.Ws(s)]}else if(t.key===this.Ms)(a=function(t){var e=u.o;if(null!=t)try{var n=JSON.parse(t);"number"==typeof n||g(),e=n}catch(t){p("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==u.o&&this.sequenceNumberHandler(a);else if(t.key===this.Ks)return[2,this.syncEngine.ci()]}}else this.$s.push(t);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new rB(this.currentUser,t,e,n),i=rq(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=rq(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=rU(this.persistenceKey,t),i=new rj(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return rK.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return rB.Vs(new rM(i),r,e)},t.prototype.ri=function(t,e){var n=Number(this.qs.exec(t)[1]);return rj.Vs(n,e)},t.prototype.js=function(t){return rQ.Vs(t)},t.prototype.ii=function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(d("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.Fs=r})},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=em;return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),rW=function(){function t(){this.li=new rG,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new rG,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),rH=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),rY=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){d("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){d("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),r$={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},rX=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),rJ=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return(0,r.__extends)(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise(function(i,o){var a=new s.JJ;a.listenOnce(s.tw.COMPLETE,function(){try{switch(a.getLastErrorCode()){case s.jK.NO_ERROR:var e=a.getResponseJson();d("Connection","XHR received:",JSON.stringify(e)),i(e);break;case s.jK.TIMEOUT:d("Connection",'RPC "'+t+'" timed out'),o(new h(c.DEADLINE_EXCEEDED,"Request time out"));break;case s.jK.HTTP_ERROR:var n=a.getStatus();if(d("Connection",'RPC "'+t+'" failed with status:',n,"response text:",a.getResponseText()),n>0){var r=a.getResponseJson().error;if(r&&r.status&&r.message){var u,l=(u=r.status.toLowerCase().replace(/_/g,"-"),Object.values(c).indexOf(u)>=0?u:c.UNKNOWN);o(new h(l,r.message))}else o(new h(c.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new h(c.UNAVAILABLE,"Connection failed."));break;default:g()}}finally{d("Connection",'RPC "'+t+'" completed.')}});var u=JSON.stringify(r);a.send(e,"POST",u,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=(0,s.UE)(),o=(0,s.FJ)(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new s.zI({})),this.ki(a.initMessageHeaders,e),(0,i.isMobileCordova)()||(0,i.isReactNative)()||(0,i.isElectron)()||(0,i.isIE)()||(0,i.isUWP)()||(0,i.isBrowserExtension)()||(a.httpHeadersOverwriteParam="$httpHeaders");var u=n.join("");d("Connection","Creating WebChannel: "+u,a);var l=r.createWebChannel(u,a),f=!1,p=!1,m=new rX({Ei:function(t){p?d("Connection","Not sending because WebChannel is closed:",t):(f||(d("Connection","Opening WebChannel transport."),l.open(),f=!0),d("Connection","WebChannel sending:",t),l.send(t))},Ti:function(){return l.close()}}),v=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return v(l,s.ii.EventType.OPEN,function(){p||d("Connection","WebChannel transport opened.")}),v(l,s.ii.EventType.CLOSE,function(){p||(p=!0,d("Connection","WebChannel transport closed"),m.Vi())}),v(l,s.ii.EventType.ERROR,function(t){p||(p=!0,y("Connection","WebChannel transport errored:",t),m.Vi(new h(c.UNAVAILABLE,"The operation could not be completed")))}),v(l,s.ii.EventType.MESSAGE,function(t){var e;if(!p){var n=t.data[0];n||g();var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){d("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=t9[t];if(void 0!==e)return eo(e)}(i),s=r.message;void 0===o&&(o=c.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),p=!0,m.Vi(new h(o,s)),l.close()}else d("Connection","WebChannel received:",n),m.Si(n)}}),v(o,s.ju.STAT_EVENT,function(t){t.stat===s.kN.PROXY?d("Connection","Detected buffering proxy"):t.stat===s.kN.NOPROXY&&d("Connection","Detected no buffering proxy")}),setTimeout(function(){m.Pi()},0),m},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);d("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then(function(t){return d("RestConnection","Received: ",t),t},function(e){throw y("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=r$[t];return this.Di+"/v1/"+e+":"+n},t}());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rZ(){return"undefined"!=typeof window?window:null}function r0(){return"undefined"!=typeof document?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r1(t){return new eA(t,!0)}var r2=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&d("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),r4=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new r2(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===c.RESOURCE_EXHAUSTED?(p(e.toString()),p("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===c.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new h(c.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,r.__awaiter)(t,void 0,void 0,function(){return(0,r.__generator)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return d("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(d("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),r3=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,r.__extends)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r,i,o,s,a="NO_CHANGE"===(r=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:g(),u=e.targetChange.targetIds||[],l=(i=e.targetChange.resumeToken,t.I?(void 0===i||"string"==typeof i||g(),C.fromBase64String(i||"")):(void 0===i||i instanceof Uint8Array||g(),C.fromUint8Array(i||new Uint8Array))),f=(d=e.targetChange.cause)&&(s=void 0===(o=d).code?c.UNKNOWN:eo(o.code),new h(s,o.message||""));n=new eb(a,u,l,f||null)}else if("documentChange"in e){e.documentChange,(a=e.documentChange).document,a.document.name,a.document.updateTime,u=eP(t,a.document.name),l=eC(a.document.updateTime);var d=new te({mapValue:{fields:a.document.fields}}),p=(f=tn.newFoundDocument(u,l,d),a.targetIds||[]),y=a.removedTargetIds||[];n=new e_(p,y,f.key,f)}else if("documentDelete"in e)e.documentDelete,(a=e.documentDelete).document,u=eP(t,a.document),l=a.readTime?eC(a.readTime):I.min(),d=tn.newNoDocument(u,l),f=a.removedTargetIds||[],n=new e_([],f,d.key,d);else if("documentRemove"in e)e.documentRemove,(a=e.documentRemove).document,u=eP(t,a.document),l=a.removedTargetIds||[],n=new e_([],l,u,null);else{if(!("filter"in e))return g();e.filter;var m=e.filter;m.targetId,a=m.count||0,u=new er(a),l=m.targetId,n=new ew(l,u)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return I.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?I.min():e.readTime?eC(e.readTime):I.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e,n,r,i,o={};o.database=eV(this.R),o.addTarget=(e=this.R,(n=ta(r=t.target)?{documents:eQ(e,r)}:{query:eG(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=ek(e,t.resumeToken):t.snapshotVersion.compareTo(I.min())>0&&(n.readTime=ex(e,t.snapshotVersion.toTimestamp())),n);var s=(this.R,null==(i=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return g()}}(0,t.purpose))?null:{"goog-listen-tags":i});s&&(o.labels=s),this.cr(o)},e.prototype.yr=function(t){var e={};e.database=eV(this.R),e.removeTarget=t,this.cr(e)},e}(r4),r5=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,r.__extends)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(t.streamToken||g(),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e,n,r=(e=t.writeResults,n=t.commitTime,e&&e.length>0?(void 0!==n||g(),e.map(function(t){var e;return(e=t.updateTime?eC(t.updateTime):eC(n)).isEqual(I.min())&&(e=eC(n)),new tX(e,t.transformResults||[])})):[]),i=eC(t.commitTime);return this.listener.Tr(i,r)}return t.writeResults&&0!==t.writeResults.length&&g(),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=eV(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return ej(e.R,t)})};this.cr(n)},e}(r4),r6=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,r.__extends)(e,t),e.prototype.br=function(){if(this.Rr)throw new h(c.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===c.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new h(c.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===c.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new h(c.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),r8=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(p(e),this.Vr=!1):d("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),r7=function(t,e,n,i,o){var s=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=o,this.Lr.di(function(t){n.enqueueAndForget(function(){return(0,r.__awaiter)(s,void 0,void 0,function(){return(0,r.__generator)(this,function(t){switch(t.label){case 0:return iu(this)?(d("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return(e=t).Or.add(4),[4,it(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,r9(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new r8(n,i)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r9(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:if(!iu(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function it(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function ie(t,e){t.$r.has(e.targetId)||(t.$r.set(e.targetId,e),ia(t)?is(t):iE(t).er()&&ii(t,e))}function ir(t,e){var n=iE(t);t.$r.delete(e),n.er()&&io(t,e),0===t.$r.size&&(n.er()?n.ir():iu(t)&&t.Br.set("Unknown"))}function ii(t,e){t.qr.U(e.targetId),iE(t).mr(e)}function io(t,e){t.qr.U(e),iE(t).yr(e)}function is(t){t.qr=new eE({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),iE(t).start(),t.Br.Sr()}function ia(t){return iu(t)&&!iE(t).tr()&&t.$r.size>0}function iu(t){return 0===t.Or.size}function ic(t){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(e){return t.$r.forEach(function(e,n){ii(t,e)}),[2]})})}function ih(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(n){return t.qr=void 0,ia(t)?(t.Br.Nr(e),is(t)):t.Br.set("Unknown"),[2]})})}function il(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s;return(0,r.__generator)(this,function(a){switch(a.label){case 0:if(t.Br.set("Online"),!(e instanceof eb&&2===e.state&&e.cause))return[3,6];a.label=1;case 1:return a.trys.push([1,3,,5]),[4,function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s;return(0,r.__generator)(this,function(r){switch(r.label){case 0:n=e.cause,i=0,o=e.targetIds,r.label=1;case 1:return i<o.length?(s=o[i],t.$r.has(s)?[4,t.remoteSyncer.rejectListen(s,n)]:[3,3]):[3,5];case 2:r.sent(),t.$r.delete(s),t.qr.removeTarget(s),r.label=3;case 3:r.label=4;case 4:return i++,[3,1];case 5:return[2]}})})}(t,e)];case 2:case 4:return a.sent(),[3,5];case 3:return i=a.sent(),d("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),[4,id(t,i)];case 5:return[3,13];case 6:if(e instanceof e_?t.qr.X(e):e instanceof ew?t.qr.rt(e):t.qr.et(e),n.isEqual(I.min()))return[3,13];a.label=7;case 7:return a.trys.push([7,11,,13]),[4,rw(t.localStore)];case 8:var u;return o=a.sent(),n.compareTo(o)>=0?[4,((u=t.qr.ut(n)).targetChanges.forEach(function(e,r){if(e.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(e.resumeToken,n))}}),u.targetMismatches.forEach(function(e){var n=t.$r.get(e);n&&(t.$r.set(e,n.withResumeToken(C.EMPTY_BYTE_STRING,n.snapshotVersion)),io(t,e),ii(t,new nT(n.target,e,1,n.sequenceNumber)))}),t.remoteSyncer.applyRemoteEvent(u))]:[3,10];case 9:a.sent(),a.label=10;case 10:return[3,13];case 11:return d("RemoteStore","Failed to raise snapshot:",s=a.sent()),[4,id(t,s)];case 12:return a.sent(),[3,13];case 13:return[2]}})})}function id(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i=this;return(0,r.__generator)(this,function(o){switch(o.label){case 0:if(!ny(e))throw e;return t.Or.add(1),[4,it(t)];case 1:return o.sent(),t.Br.set("Offline"),n||(n=function(){return rw(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return(0,r.__awaiter)(i,void 0,void 0,function(){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return d("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,r9(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function ip(t,e){return e().catch(function(n){return id(t,n,e)})}function iy(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,n,i,o;return(0,r.__generator)(this,function(r){var s,a,u;switch(r.label){case 0:n=iT(e=t),i=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,r.label=1;case 1:if(!(iu(s=e)&&s.Fr.length<10))return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,(a=e.localStore,u=i,a.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===u&&(u=-1),a._n.getNextMutationBatchAfterBatchId(t,u)}))];case 3:return null===(o=r.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(i=o.batchId,function(t,e){t.Fr.push(e);var n=iT(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,o),[3,6]);case 4:return[4,id(e,r.sent())];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return im(e)&&ig(e),[2]}})})}function im(t){return iu(t)&&!iT(t).tr()&&t.Fr.length>0}function ig(t){iT(t).start()}function iv(t){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(e){return iT(t).Ar(),[2]})})}function i_(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,n,i,o;return(0,r.__generator)(this,function(r){for(e=iT(t),n=0,i=t.Fr;n<i.length;n++)o=i[n],e.Er(o.mutations);return[2]})})}function iw(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return i=t.Fr.shift(),o=nE.from(i,e,n),[4,ip(t,function(){return t.remoteSyncer.applySuccessfulWrite(o)})];case 1:return r.sent(),[4,iy(t)];case 2:return r.sent(),[2]}})})}function ib(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e&&iT(t).pr?[4,function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return ei(i=e.code)&&i!==c.ABORTED?(n=t.Fr.shift(),iT(t).sr(),[4,ip(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return r.sent(),[4,iy(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return im(t)&&ig(t),[2]}})})}function iI(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=t,e?(n.Or.delete(2),[4,r9(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,it(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function iE(t){var e,n,i,o=this;return t.Ur||(t.Ur=(e=t.datastore,n=t.asyncQueue,i={Ii:ic.bind(null,t),Ri:ih.bind(null,t),_r:il.bind(null,t)},e.br(),new r3(n,e.Hi,e.credentials,e.R,i)),t.Mr.push(function(e){return(0,r.__awaiter)(o,void 0,void 0,function(){return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e?(t.Ur.sr(),ia(t)?is(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:n.sent(),t.qr=void 0,n.label=3;case 3:return[2]}})})})),t.Ur}function iT(t){var e,n,i,o=this;return t.Kr||(t.Kr=(e=t.datastore,n=t.asyncQueue,i={Ii:iv.bind(null,t),Ri:ib.bind(null,t),Ir:i_.bind(null,t),Tr:iw.bind(null,t)},e.br(),new r5(n,e.Hi,e.credentials,e.R,i)),t.Mr.push(function(e){return(0,r.__awaiter)(o,void 0,void 0,function(){return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e?(t.Kr.sr(),[4,iy(t)]):[3,2];case 1:return n.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:n.sent(),t.Fr.length>0&&(d("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),n.label=4;case 4:return[2]}})})})),t.Kr}var iS=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new nc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new h(c.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function iN(t,e){if(p("AsyncQueue",e+": "+t),ny(t))return new h(c.UNAVAILABLE,e+": "+t);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var iD=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||B.comparator(e.key,n.key)}:function(t,e){return B.comparator(t.key,e.key)},this.keyedMap=ef,this.sortedSet=new es(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t)||this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),iA=function(){function t(){this.Qr=new es(B.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):g():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),ix=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,iD.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&tR(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),ik=function(){this.Wr=void 0,this.listeners=[]},iC=function(){this.queries=new rt(function(t){return tL(t)},tR),this.onlineState="Unknown",this.Gr=new Set};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iR(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s,a,u;return(0,r.__generator)(this,function(r){switch(r.label){case 0:if(n=t,i=e.query,o=!1,(s=n.queries.get(i))||(o=!0,s=new ik),!o)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),a=s,[4,n.onListen(i)];case 2:return a.Wr=r.sent(),[3,4];case 3:return u=iN(r.sent(),"Initialization of query '"+tO(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(i,s),s.listeners.push(e),e.zr(n.onlineState),s.Wr&&e.Hr(s.Wr)&&iF(n),[2]}})})}function iL(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s;return(0,r.__generator)(this,function(r){return n=e.query,i=!1,(o=t.queries.get(n))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(t.queries.delete(n),t.onUnlisten(n))]:[2]})})}function iO(t,e){for(var n=!1,r=0;r<e.length;r++){var i=e[r],o=i.query,s=t.queries.get(o);if(s){for(var a=0,u=s.listeners;a<u.length;a++)u[a].Hr(i)&&(n=!0);s.Wr=i}}n&&iF(t)}function iP(t,e,n){var r=t.queries.get(e);if(r)for(var i=0,o=r.listeners;i<o.length;i++)o[i].onError(n);t.queries.delete(e)}function iF(t){t.Gr.forEach(function(t){t.next()})}var iM=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new ix(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=ix.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),iV=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),iq=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return eP(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?eB(this.R,t.document,!1):tn.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return eC(t)},t}(),iU=function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=iB(t)}return t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new iq(this.R),r=0;r<t.length;r++){var i=t[r];if(i.metadata.queries)for(var o=n.qn(i.metadata.name),s=0,a=i.metadata.queries;s<a.length;s++){var u=a[s],c=(e.get(u)||ey()).add(o);e.set(u,c)}}return e},t.prototype.complete=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,e,n,i,o;return(0,r.__generator)(this,function(s){switch(s.label){case 0:return[4,function(t,e,n,i){return(0,r.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c,h,l,f,d;return(0,r.__generator)(this,function(r){switch(r.label){case 0:for(o=t,s=ey(),a=el,u=ed,c=0;c<n.length;c++)h=n[c],l=e.qn(h.metadata.name),h.document&&(s=s.add(l)),a=a.insert(l,e.Un(h)),u=u.insert(l,e.Kn(h.metadata.readTime));return f=o.On.newChangeBuffer({trackRemovals:!0}),[4,rI(o,tk(tE(D.fromString("__bundle__/docs/"+i))))];case 1:return d=r.sent(),[2,o.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return rb(t,f,a,I.min(),u).next(function(e){return f.apply(t),e}).next(function(e){return o.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return o.qe.addMatchingKeys(t,s,d.targetId)}).next(function(){return o.Mn.En(t,e)}).next(function(){return e})})})]}})})}(this.localStore,new iq(this.R),this.documents,this.ro.id)];case 1:t=s.sent(),e=this.co(this.documents),n=0,i=this.queries,s.label=2;case 2:return n<i.length?(o=i[n],[4,function(t,e,n){return void 0===n&&(n=ey()),(0,r.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,rI(t,tk(nP(e.bundledQuery)))];case 1:return i=r.sent(),[2,(o=t).persistence.runTransaction("Save named query","readwrite",function(t){var r=eC(e.readTime);if(i.snapshotVersion.compareTo(r)>=0)return o.Ke.saveNamedQuery(t,e);var s=i.withResumeToken(C.EMPTY_BYTE_STRING,r);return o.kn=o.kn.insert(s.targetId,s),o.qe.updateTargetData(t,s).next(function(){return o.qe.removeMatchingKeysForTargetId(t,i.targetId)}).next(function(){return o.qe.addMatchingKeys(t,n,i.targetId)}).next(function(){return o.Ke.saveNamedQuery(t,e)})})]}})})}(this.localStore,o,e.get(o.name))]):[3,5];case 3:s.sent(),s.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new rp(Object.assign({},this.progress),t))]}})})},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iB(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ij=function(t){this.key=t},iK=function(t){this.key=t},iQ=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=ey(),this.mutatedKeys=ey(),this.lo=tF(t),this.fo=new iD(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new iA,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=tT(this.query)&&i.size===this.query.limit?i.last():null,c=tS(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=tP(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&0>n.lo(l,c))&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),tT(this.query)||tS(this.query))for(;s.size>this.query.limit;){var h=tT(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){var n,i,o;return n=t.type,i=e.type,(o=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return g()}})(n)-o(i)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new ix(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new iA,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=ey(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new iK(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new ij(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=ey();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return ix.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),iG=function(t,e,n){this.query=t,this.targetId=e,this.view=n},iz=function(t){this.key=t,this.bo=!1},iW=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new rt(function(t){return tL(t)},tR),this.Vo=new Map,this.So=new Set,this.Do=new es(B.comparator),this.Co=new Map,this.No=new rA,this.xo={},this.ko=new Map,this.Fo=nJ.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function iH(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s,a,u;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return(s=(n=oh(t)).Po.get(e))?(i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),o=s.view.Ro(),[3,4]):[3,1];case 1:return[4,rI(n.localStore,tk(e))];case 2:return a=r.sent(),u=n.sharedClientState.addLocalQueryTarget(a.targetId),[4,iY(n,e,i=a.targetId,"current"===u)];case 3:o=r.sent(),n.isPrimaryClient&&ie(n.remoteStore,a),r.label=4;case 4:return[2,o]}})})}function iY(t,e,n,i){return(0,r.__awaiter)(this,void 0,void 0,function(){var o,s,a,u,c,h;return(0,r.__generator)(this,function(l){switch(l.label){case 0:return t.Oo=function(e,n,i){return function(t,e,n,i){return(0,r.__awaiter)(this,void 0,void 0,function(){var o,s,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return(o=e.view._o(n)).Nn?[4,rT(t.localStore,e.query,!1).then(function(t){var n=t.documents;return e.view._o(n,o)})]:[3,2];case 1:o=r.sent(),r.label=2;case 2:return s=i&&i.targetChanges.get(e.targetId),a=e.view.applyChanges(o,t.isPrimaryClient,s),[2,(i7(t,e.targetId,a.To),a.snapshot)]}})})}(t,e,n,i)},[4,rT(t.localStore,e,!0)];case 1:return o=l.sent(),a=(s=new iQ(e,o.Bn))._o(o.documents),u=ev.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState),c=s.applyChanges(a,t.isPrimaryClient,u),i7(t,n,c.To),h=new iG(e,n,s),[2,(t.Po.set(e,h),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),c.snapshot)]}})})}function i$(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return i=(n=t).Po.get(e),(o=n.Vo.get(i.targetId)).length>1?[2,(n.Vo.set(i.targetId,o.filter(function(t){return!tR(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)?[3,2]:[4,rE(n.localStore,i.targetId,!1).then(function(){n.sharedClientState.clearQueryState(i.targetId),ir(n.remoteStore,i.targetId),i6(n,i.targetId)}).catch(n4)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return i6(n,i.targetId),[4,rE(n.localStore,i.targetId,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})}function iX(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s;return(0,r.__generator)(this,function(r){var a,u,c,h,l,f,d;switch(r.label){case 0:i=ol(t),r.label=1;case 1:return r.trys.push([1,5,,6]),[4,(a=i.localStore,c=b.now(),h=e.reduce(function(t,e){return t.add(e.key)},ey()),a.persistence.runTransaction("Locally write mutations","readwrite",function(t){return a.Mn.pn(t,h).next(function(n){u=n;for(var r=[],i=0;i<e.length;i++){var o=e[i],s=function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=tB(o.transform,s||null);null!=a&&(null==n&&(n=te.empty()),n.set(o.field,a))}return n||null}(o,u.get(o.key));null!=s&&r.push(new t5(o.key,s,function t(e){var n=[];return T(e.fields,function(e,r){var i=new x([e]);if(Z(r)){var o=t(r.mapValue).fields;if(0===o.length)n.push(i);else for(var s=0;s<o.length;s++){var a=o[s];n.push(i.child(a))}}else n.push(i)}),new k(n)}(s.value.mapValue),tJ.exists(!0)))}return a._n.addMutationBatch(t,c,r,e)})}).then(function(t){return t.applyToLocalDocumentSet(u),{batchId:t.batchId,changes:u}}))];case 2:return o=r.sent(),i.sharedClientState.addPendingMutation(o.batchId),l=i,f=o.batchId,(d=l.xo[l.currentUser.toKey()])||(d=new es(_)),d=d.insert(f,n),l.xo[l.currentUser.toKey()]=d,[4,ot(i,o.changes)];case 3:return r.sent(),[4,iy(i.remoteStore)];case 4:return r.sent(),[3,6];case 5:return s=iN(r.sent(),"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function iJ(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i;return(0,r.__generator)(this,function(r){var o,s,a;switch(r.label){case 0:n=t,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,(o=n.localStore,s=e.snapshotVersion,a=o.kn,o.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var n=o.On.newChangeBuffer({trackRemovals:!0});a=o.kn;var r=[];e.targetChanges.forEach(function(e,n){var i=a.get(n);if(i){r.push(o.qe.removeMatchingKeys(t,e.removedDocuments,n).next(function(){return o.qe.addMatchingKeys(t,e.addedDocuments,n)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=i.withResumeToken(u,s).withSequenceNumber(t.currentSequenceNumber);a=a.insert(n,c),c.resumeToken.approximateByteSize()>0||g(),(0===i.resumeToken.approximateByteSize()||c.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()>=3e8||e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size>0)&&r.push(o.qe.updateTargetData(t,c))}}});var i=el;if(e.documentUpdates.forEach(function(n,i){e.resolvedLimboDocuments.has(n)&&r.push(o.persistence.referenceDelegate.updateLimboDocument(t,n))}),r.push(rb(t,n,e.documentUpdates,s,void 0).next(function(t){i=t})),!s.isEqual(I.min())){var u=o.qe.getLastRemoteSnapshotVersion(t).next(function(e){return o.qe.setTargetsMetadata(t,t.currentSequenceNumber,s)});r.push(u)}return nh.waitFor(r).next(function(){return n.apply(t)}).next(function(){return o.Mn.En(t,i)}).next(function(){return i})}).then(function(t){return o.kn=a,t}))];case 2:return i=r.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||g(),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?r.bo||g():t.removedDocuments.size>0&&(r.bo||g(),r.bo=!1))}),[4,ot(n,i,e)];case 3:case 5:return r.sent(),[3,6];case 4:return[4,n4(r.sent())];case 6:return[2]}})})}function iZ(t,e,n){var r=t;if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i,o,s=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&s.push(r.snapshot)}),(i=r.eventManager).onlineState=e,o=!1,i.queries.forEach(function(t,n){for(var r=0,i=n.listeners;r<i.length;r++)i[r].zr(e)&&(o=!0)}),o&&iF(i),s.length&&r.vo._r(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function i0(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return(i=t).sharedClientState.updateQueryState(e,"rejected",n),(s=(o=i.Co.get(e))&&o.key)?(a=(a=new es(B.comparator)).insert(s,tn.newNoDocument(s,I.min())),u=ey().add(s),[4,iJ(i,new eg(I.min(),new Map,new ec(_),a,u))]):[3,2];case 1:return r.sent(),i.Do=i.Do.remove(s),i.Co.delete(e),i9(i),[3,4];case 2:return[4,rE(i.localStore,e,!1).then(function(){return i6(i,e,n)}).catch(n4)];case 3:r.sent(),r.label=4;case 4:return[2]}})})}function i1(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o;return(0,r.__generator)(this,function(r){var s;switch(r.label){case 0:n=t,i=e.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,(s=n.localStore).persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var n,r,i,o=e.batch.keys(),a=s.On.newChangeBuffer({trackRemovals:!0});return(r=(n=e.batch).keys(),i=nh.resolve(),r.forEach(function(r){i=i.next(function(){return a.getEntry(t,r)}).next(function(t){var i=e.docVersions.get(r);null!==i||g(),0>t.version.compareTo(i)&&(n.applyToRemoteDocument(t,e),t.isValidDocument()&&a.addEntry(t,e.commitVersion))})}),i.next(function(){return s._n.removeMutationBatch(t,n)})).next(function(){return a.apply(t)}).next(function(){return s._n.performConsistencyCheck(t)}).next(function(){return s.Mn.pn(t,o)})})];case 2:return o=r.sent(),i5(n,i,null),i3(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),[4,ot(n,o)];case 3:case 5:return r.sent(),[3,6];case 4:return[4,n4(r.sent())];case 6:return[2]}})})}function i2(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,r.__generator)(this,function(r){var s;switch(r.label){case 0:i=t,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,(s=i.localStore).persistence.runTransaction("Reject batch","readwrite-primary",function(t){var n;return s._n.lookupMutationBatch(t,e).next(function(e){return null!==e||g(),n=e.keys(),s._n.removeMutationBatch(t,e)}).next(function(){return s._n.performConsistencyCheck(t)}).next(function(){return s.Mn.pn(t,n)})})];case 2:return o=r.sent(),i5(i,e,n),i3(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),[4,ot(i,o)];case 3:case 5:return r.sent(),[3,6];case 4:return[4,n4(r.sent())];case 6:return[2]}})})}function i4(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s;return(0,r.__generator)(this,function(r){var a;switch(r.label){case 0:iu((n=t).remoteStore)||d("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,(a=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return a._n.getHighestUnacknowledgedBatchId(t)})];case 2:return -1===(i=r.sent())?[2,void e.resolve()]:((o=n.ko.get(i)||[]).push(e),n.ko.set(i,o),[3,4]);case 3:return s=iN(r.sent(),"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function i3(t,e){(t.ko.get(e)||[]).forEach(function(t){t.resolve()}),t.ko.delete(e)}function i5(t,e,n){var r=t,i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function i6(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||i8(t,e)})}function i8(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(ir(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),i9(t))}function i7(t,e,n){for(var r=0;r<n.length;r++){var i=n[r];i instanceof ij?(t.No.addReference(i.key,e),function(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(d("SyncEngine","New document in limbo: "+n),t.So.add(r),i9(t))}(t,i)):i instanceof iK?(d("SyncEngine","Document no longer in limbo: "+i.key),t.No.removeReference(i.key,e),t.No.containsKey(i.key)||i8(t,i.key)):g()}}function i9(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new B(D.fromString(e)),r=t.Fo.next();t.Co.set(r,new iz(n)),t.Do=t.Do.insert(n,r),ie(t.remoteStore,new nT(tk(tE(n.path)),r,2,u.o))}}function ot(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,r.__generator)(this,function(u){switch(u.label){case 0:return o=[],s=[],a=[],(i=t).Po.isEmpty()?[3,3]:(i.Po.forEach(function(t,r){a.push(i.Oo(r,e,n).then(function(t){if(t){i.isPrimaryClient&&i.sharedClientState.updateQueryState(r.targetId,t.fromCache?"not-current":"current"),o.push(t);var e=rm.Pn(r.targetId,t);s.push(e)}}))}),[4,Promise.all(a)]);case 1:return u.sent(),i.vo._r(o),[4,function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s,a,u,c,h;return(0,r.__generator)(this,function(r){switch(r.label){case 0:n=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return nh.forEach(e,function(e){return nh.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return nh.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return r.sent(),[3,4];case 3:if(!ny(i=r.sent()))throw i;return d("LocalStore","Failed to update sequence numbers: "+i),[3,4];case 4:for(o=0;o<e.length;o++)a=(s=e[o]).targetId,s.fromCache||(c=(u=n.kn.get(a)).snapshotVersion,h=u.withLastLimboFreeSnapshotVersion(c),n.kn=n.kn.insert(a,h));return[2]}})})}(i.localStore,s)];case 2:u.sent(),u.label=3;case 3:return[2]}})})}function oe(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i;return(0,r.__generator)(this,function(r){var o;switch(r.label){case 0:return(n=t).currentUser.isEqual(e)?[3,3]:(d("SyncEngine","User change. New user:",e.toKey()),[4,r_(n.localStore,e)]);case 1:return i=r.sent(),n.currentUser=e,(o=n).ko.forEach(function(t){t.forEach(function(t){t.reject(new h(c.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.ko.clear(),n.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),[4,ot(n,i.Ln)];case 2:r.sent(),r.label=3;case 3:return[2]}})})}function on(t,e){var n=t.Co.get(e);if(n&&n.bo)return ey().add(n.key);var r=ey(),i=t.Vo.get(e);if(!i)return r;for(var o=0;o<i.length;o++){var s=i[o],a=t.Po.get(s);r=r.unionWith(a.view.wo)}return r}function or(t){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(e){return[2,rN(t.localStore).then(function(e){return ot(t,e)})]})})}function oi(t,e,n,i){return(0,r.__awaiter)(this,void 0,void 0,function(){var o,s;return(0,r.__generator)(this,function(r){switch(r.label){case 0:var a,u;return[4,(u=(a=(o=t).localStore)._n,a.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return u.jt(t,e).next(function(e){return e?a.Mn.pn(t,e):nh.resolve(null)})}))];case 1:return null===(s=r.sent())?[3,6]:"pending"!==n?[3,3]:[4,iy(o.remoteStore)];case 2:return r.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(i5(o,e,i||null),i3(o,e),function(t,e){t._n.Gt(e)}(o.localStore,e)):g(),r.label=4;case 4:return[4,ot(o,s)];case 5:return r.sent(),[3,7];case 6:d("SyncEngine","Cannot apply mutation batch with id: "+e),r.label=7;case 7:return[2]}})})}function oo(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s,a,u,c,h,l,f,d,p,y,m;return(0,r.__generator)(this,function(g){switch(g.label){case 0:n=t,i=[],o=[],s=0,a=e,g.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=n.Vo.get(u))&&0!==h.length?[4,rI(n.localStore,tk(h[0]))]:[3,7]):[3,13];case 2:c=g.sent(),l=0,f=h,g.label=3;case 3:return l<f.length?(d=f[l],p=n.Po.get(d),[4,function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,rT((n=t).localStore,e.query,!0)];case 1:return i=r.sent(),o=e.view.Ao(i),[2,(n.isPrimaryClient&&i7(n,e.targetId,o.To),o)]}})})}(n,p)]):[3,6];case 4:(y=g.sent()).snapshot&&o.push(y.snapshot),g.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,rS(n.localStore,u)];case 8:return m=g.sent(),[4,rI(n.localStore,m)];case 9:return c=g.sent(),[4,iY(n,os(m),u,!1)];case 10:g.sent(),g.label=11;case 11:i.push(c),g.label=12;case 12:return s++,[3,1];case 13:return[2,(n.vo._r(o),i)]}})})}function os(t){var e,n,r,i,o,s,a;return e=t.path,n=t.collectionGroup,r=t.orderBy,i=t.filters,o=t.limit,s=t.startAt,a=t.endAt,new tI(e,n,r,i,o,"F",s,a)}function oa(t){return t.localStore.persistence.fn()}function ou(t,e,n,i){return(0,r.__awaiter)(this,void 0,void 0,function(){var o;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return(o=t).$o?(d("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!o.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,rN(o.localStore)];case 3:return[4,ot(o,r.sent(),eg.createSynthesizedRemoteEventForCurrentChange(e,"current"===n))];case 4:return r.sent(),[3,8];case 5:return[4,rE(o.localStore,e,!0)];case 6:return r.sent(),i6(o,e,i),[3,8];case 7:g(),r.label=8;case 8:return[2]}})})}function oc(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f;return(0,r.__generator)(this,function(p){switch(p.label){case 0:if(!(i=oh(t)).$o)return[3,10];o=0,s=e,p.label=1;case 1:return o<s.length?(a=s[o],i.Vo.has(a)?(d("SyncEngine","Adding an already active target "+a),[3,5]):[4,rS(i.localStore,a)]):[3,6];case 2:return u=p.sent(),[4,rI(i.localStore,u)];case 3:return c=p.sent(),[4,iY(i,os(u),c.targetId,!1)];case 4:p.sent(),ie(i.remoteStore,c),p.label=5;case 5:return o++,[3,1];case 6:h=function(t){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return i.Vo.has(t)?[4,rE(i.localStore,t,!1).then(function(){ir(i.remoteStore,t),i6(i,t)}).catch(n4)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},l=0,f=n,p.label=7;case 7:return l<f.length?[5,h(f[l])]:[3,10];case 8:p.sent(),p.label=9;case 9:return l++,[3,7];case 10:return[2]}})})}function oh(t){var e=t;return e.remoteStore.remoteSyncer.applyRemoteEvent=iJ.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=on.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=i0.bind(null,e),e.vo._r=iO.bind(null,e.eventManager),e.vo.Mo=iP.bind(null,e.eventManager),e}function ol(t){var e=t;return e.remoteStore.remoteSyncer.applySuccessfulWrite=i1.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=i2.bind(null,e),e}function of(t,e,n){(function(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s,a,u,c;return(0,r.__generator)(this,function(r){var h,l,f,d,p,m;switch(r.label){case 0:return r.trys.push([0,14,,15]),[4,e.getMetadata()];case 1:return i=r.sent(),[4,(h=t.localStore,f=eC((l=i).createTime),h.persistence.runTransaction("hasNewerBundle","readonly",function(t){return h.Ke.getBundleMetadata(t,l.id)}).then(function(t){return!!t&&t.createTime.compareTo(f)>=0}))];case 2:return r.sent()?[4,e.close()]:[3,4];case 3:return[2,(r.sent(),void n._completeWith({taskState:"Success",documentsLoaded:(d=i).totalDocuments,bytesLoaded:d.totalBytes,totalDocuments:d.totalDocuments,totalBytes:d.totalBytes}))];case 4:return n._updateProgress(iB(i)),o=new iU(i,t.localStore,e.R),[4,e.Lo()];case 5:s=r.sent(),r.label=6;case 6:return s?[4,o.oo(s)]:[3,10];case 7:return(a=r.sent())&&n._updateProgress(a),[4,e.Lo()];case 8:s=r.sent(),r.label=9;case 9:return[3,6];case 10:return[4,o.complete()];case 11:return[4,ot(t,(u=r.sent()).wn,void 0)];case 12:return r.sent(),[4,(p=t.localStore,m=i,p.persistence.runTransaction("Save bundle","readwrite",function(t){return p.Ke.saveBundleMetadata(t,m)}))];case 13:return r.sent(),n._completeWith(u.progress),[3,15];case 14:return y("SyncEngine","Loading bundle failed with "+(c=r.sent())),n._failWith(c),[3,15];case 15:return[2]}})})})(t,e,n).then(function(){t.sharedClientState.notifyBundleLoaded()})}var od=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return this.R=r1(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){var e,n,r,i;return e=this.persistence,n=new rg,r=t.initialUser,i=this.R,new rv(e,n,r,i)},t.prototype.qo=function(t){return new rO(rF.bs,this.R)},t.prototype.Bo=function(t){return new rW},t.prototype.terminate=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),op=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,r.__extends)(e,t),e.prototype.initialize=function(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n=this;return(0,r.__generator)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),[4,function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){return[2,(e=t).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){var e,n;return e=ro(t),n=I.min(),e.$t({index:e8.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=nx(e.readTime)),r.done()}).next(function(){return n})}).then(function(t){e.$n=t})]})})}(this.localStore)];case 2:return i.sent(),[4,this.Qo.initialize(this,e)];case 3:return i.sent(),[4,ol(this.Qo.syncEngine)];case 4:return i.sent(),[4,iy(this.Qo.remoteStore)];case 5:return i.sent(),[4,this.persistence.He(function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()})];case 6:return i.sent(),[2]}})})},e.prototype.Ko=function(t){var e,n,r,i;return e=this.persistence,n=new rg,r=t.initialUser,i=this.R,new rv(e,n,r,i)},e.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new n6(e,t.asyncQueue)},e.prototype.qo=function(t){var e=rd(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?nQ.withCacheSize(this.cacheSizeBytes):nQ.DEFAULT;return new rh(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,rZ(),r0(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new rW},e}(od),oy=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,r.__extends)(e,t),e.prototype.initialize=function(e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i=this;return(0,r.__generator)(this,function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return o.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof rz?(this.sharedClientState.syncEngine={ui:oi.bind(null,n),ai:ou.bind(null,n),hi:oc.bind(null,n),fn:oa.bind(null,n),ci:or.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He(function(t){return(0,r.__awaiter)(i,void 0,void 0,function(){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return[4,function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s,a,u,c,h;return(0,r.__generator)(this,function(r){var l;switch(r.label){case 0:return oh(n=t),ol(n),!0!==e||!0===n.$o?[3,3]:(i=n.sharedClientState.getAllActiveQueryTargets(),[4,oo(n,i.toArray())]);case 1:return o=r.sent(),n.$o=!0,[4,iI(n.remoteStore,!0)];case 2:for(r.sent(),s=0,a=o;s<a.length;s++)u=a[s],ie(n.remoteStore,u);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(c=[],h=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?c.push(e):h=h.then(function(){return i6(n,e),rE(n.localStore,e,!0)}),ir(n.remoteStore,e)}),[4,h]);case 4:return r.sent(),[4,oo(n,c)];case 5:return r.sent(),(l=n).Co.forEach(function(t,e){ir(l.remoteStore,e)}),l.No.ts(),l.Co=new Map,l.Do=new es(B.comparator),n.$o=!1,[4,iI(n.remoteStore,!1)];case 6:r.sent(),r.label=7;case 7:return[2]}})})}(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},e.prototype.Bo=function(t){var e=rZ();if(!rz.yt(e))throw new h(c.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=rd(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new rz(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(op),om=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n=this;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return iZ(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=oe.bind(null,this.syncEngine),[4,iI(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new iC},t.prototype.createDatastore=function(t){var e,n,r=r1(t.databaseInfo.databaseId),i=(n=t.databaseInfo,new rJ(n));return e=t.credentials,new r6(e,i,r)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=rY.yt()?new rY:new rH,new r7(e,n,r,function(t){return iZ(o.syncEngine,t,0)},i)},t.prototype.createSyncEngine=function(t,e){var n,r,i,o,s,a,u;return n=this.localStore,r=this.remoteStore,i=this.eventManager,o=this.sharedClientState,s=t.initialUser,a=t.maxConcurrentLimboResolutions,u=new iW(n,r,i,o,s,a),e&&(u.$o=!0),u},t.prototype.terminate=function(){return function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e=t,d("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,it(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function og(t,e){void 0===e&&(e=10240);var n=0;return{read:function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var i;return(0,r.__generator)(this,function(r){return n<t.byteLength?(i={value:t.slice(n,n+e),done:!1},[2,(n+=e,i)]):[2,{done:!0}]})})},cancel:function(){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ov=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),o_=function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new nc,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}return t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,e,n,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,this.Jo()];case 1:return null===(t=r.sent())?[2,null]:(isNaN(n=Number(e=this.zo.decode(t)))&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return i=r.sent(),[2,new iV(JSON.parse(i),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return 123===t})},t.prototype.Jo=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return 0>this.Zo()?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})},t}(),ow=function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,n=this;return(0,r.__generator)(this,function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new h(c.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o,s,a,u;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return i=eV((n=t).R)+"/documents",o={documents:e.map(function(t){return eO(n.R,t)})},[4,n.$i("BatchGetDocuments",i,o)];case 1:return s=r.sent(),a=new Map,s.forEach(function(t){var e,r,i,o,s,u,c=(e=n.R,"found"in t?(t.found||g(),t.found.name,t.found.updateTime,r=eP(e,t.found.name),i=eC(t.found.updateTime),o=new te({mapValue:{fields:t.found.fields}}),tn.newFoundDocument(r,i,o)):"missing"in t?(t.missing||g(),t.readTime||g(),s=eP(e,t.missing),u=eC(t.readTime),tn.newNoDocument(s,u)):g());a.set(c.key.toString(),c)}),u=[],[2,(e.forEach(function(t){var e=a.get(t.toString());e||g(),u.push(e)}),u)]}})})}(this.datastore,t)];case 1:return[2,((e=i.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new ee(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,e=this;return(0,r.__generator)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=B.fromPath(n);e.mutations.push(new en(r,e.precondition(r)))}),[4,function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=eV(t.R)+"/documents",i={writes:e.map(function(e){return ej(t.R,e)})},[4,t.Ni("Commit",n,i)];case 1:return r.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw g();e=I.min()}var e,n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new h(c.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?tJ.updateTime(e):tJ.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(I.min()))throw new h(c.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return tJ.updateTime(e)}return tJ.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}(),ob=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new r2(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,r.__awaiter)(t,void 0,void 0,function(){var t,e,n=this;return(0,r.__generator)(this,function(r){return t=new ow(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!V(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!ei(e)}return!1},t}(),oI=function(){function t(t,e,n){var i=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=rM.UNAUTHENTICATED,this.clientId=v.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return(0,r.__awaiter)(i,void 0,void 0,function(){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return d("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new h(c.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new nc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,r.__awaiter)(t,void 0,void 0,function(){var t;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return n.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:n.sent(),n.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=iN(n.sent(),"Failed to shutdown persistence"),e.reject(t),[3,6];case 6:return[2]}})})}),e.promise},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oE(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i,o=this;return(0,r.__generator)(this,function(s){switch(s.label){case 0:return t.asyncQueue.verifyOperationInProgress(),d("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=s.sent(),[4,e.initialize(n)];case 2:return s.sent(),i=n.initialUser,t.setCredentialChangeListener(function(t){return(0,r.__awaiter)(o,void 0,void 0,function(){return(0,r.__generator)(this,function(n){switch(n.label){case 0:return i.isEqual(t)?[3,2]:[4,r_(e.localStore,t)];case 1:n.sent(),i=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function oT(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i;return(0,r.__generator)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,oS(t)];case 1:return n=o.sent(),d("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return i=o.sent(),[4,e.initialize(n,i)];case 3:return o.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return(0,r.__awaiter)(this,void 0,void 0,function(){var n,i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return(n=t).asyncQueue.verifyOperationInProgress(),d("RemoteStore","RemoteStore received new credentials"),i=iu(n),n.Or.add(3),[4,it(n)];case 1:return r.sent(),i&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return r.sent(),n.Or.delete(3),[4,r9(n)];case 3:return r.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function oS(t){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(d("FirestoreClient","Using default OfflineComponentProvider"),[4,oE(t,new od)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function oN(t){return(0,r.__awaiter)(this,void 0,void 0,function(){return(0,r.__generator)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(d("FirestoreClient","Using default OnlineComponentProvider"),[4,oT(t,new om)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function oD(t){return oS(t).then(function(t){return t.persistence})}function oA(t){return oS(t).then(function(t){return t.localStore})}function ox(t){return oN(t).then(function(t){return t.remoteStore})}function ok(t){return oN(t).then(function(t){return t.syncEngine})}function oC(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e,n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,oN(t)];case 1:return[2,((n=(e=r.sent()).eventManager).onListen=iH.bind(null,e.syncEngine),n.onUnlisten=i$.bind(null,e.syncEngine),n)]}})})}function oR(t,e,n){var i=this;void 0===n&&(n={});var o=new nc;return t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(i,void 0,void 0,function(){var i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return i=function(t,e,n,r,i){var o=new ov({next:function(o){e.enqueueAndForget(function(){return iL(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new h(c.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new h(c.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new iM(tE(n.path),o,{includeMetadataChanges:!0,so:!0});return iR(t,s)},[4,oC(t)];case 1:return[2,i.apply(void 0,[r.sent(),t.asyncQueue,e,n,o])]}})})}),o.promise}function oL(t,e,n){var i=this;void 0===n&&(n={});var o=new nc;return t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(i,void 0,void 0,function(){var i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return i=function(t,e,n,r,i){var o=new ov({next:function(n){e.enqueueAndForget(function(){return iL(t,s)}),n.fromCache&&"server"===r.source?i.reject(new h(c.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new iM(n,o,{includeMetadataChanges:!0,so:!0});return iR(t,s)},[4,oC(t)];case 1:return[2,i.apply(void 0,[r.sent(),t.asyncQueue,e,n,o])]}})})}),o.promise}var oO=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},oP=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),oF=new Map,oM=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},oV=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(rM.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),oq=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),oU=function(){function t(t){var e=this;this.currentUser=rM.UNAUTHENTICATED,this.oc=new nc,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){d("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(d("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(d("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?("string"==typeof n.accessToken||g(),new oM(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,r.__awaiter)(n,void 0,void 0,function(){return(0,r.__generator)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return null===t||"string"==typeof t||g(),new rM(t)},t}(),oB=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=rM.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),oj=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new oB(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(rM.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oK(t,e,n){if(!n)throw new h(c.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function oQ(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new h(c.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function oG(t,e,n,r){if(!0===e&&!0===r)throw new h(c.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function oz(t){if(!B.isDocumentKey(t))throw new h(c.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function oW(t){if(B.isDocumentKey(t))throw new h(c.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function oH(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":g()}function oY(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new h(c.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=oH(t);throw new h(c.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function o$(t,e){if(e<=0)throw new h(c.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oX=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new h(c.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new h(c.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,oG("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),oJ=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new oX({}),this._settingsFrozen=!1,t instanceof oP?(this._databaseId=t,this._credentials=new oV):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new h(c.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oP(t.options.projectId)}(t),this._credentials=new oU(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new h(c.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new h(c.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new oX(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new oV;switch(t.type){case"gapi":var e=t.client;return"object"==typeof e&&null!==e&&e.auth&&e.auth.getAuthHeaderValueForFirstParty||g(),new oj(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new h(c.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){var t;return(t=oF.get(this))&&(d("ComponentProvider","Removing Datastore"),oF.delete(this),t.terminate()),Promise.resolve()},t}(),oZ=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new o1(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),o0=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),o1=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,tE(r))||this)._path=r,i.type="collection",i}return(0,r.__extends)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new oZ(this.firestore,null,new B(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(o0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o2(t,e){for(var n,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(t=(0,i.getModularInstance)(t),oK("collection","path",e),t instanceof oJ)return oW(n=D.fromString.apply(D,(0,r.__spreadArray)([e],o))),new o1(t,null,n);if(!(t instanceof oZ||t instanceof o1))throw new h(c.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return oW(n=D.fromString.apply(D,(0,r.__spreadArray)([t.path],o)).child(D.fromString(e))),new o1(t.firestore,null,n)}function o4(t,e){for(var n,o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];if(t=(0,i.getModularInstance)(t),1==arguments.length&&(e=v.u()),oK("doc","path",e),t instanceof oJ)return oz(n=D.fromString.apply(D,(0,r.__spreadArray)([e],o))),new oZ(t,null,new B(n));if(!(t instanceof oZ||t instanceof o1))throw new h(c.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return oz(n=t._path.child(D.fromString.apply(D,(0,r.__spreadArray)([e],o)))),new oZ(t.firestore,t instanceof o1?t.converter:null,new B(n))}function o3(t,e){return t=(0,i.getModularInstance)(t),e=(0,i.getModularInstance)(e),(t instanceof oZ||t instanceof o1)&&(e instanceof oZ||e instanceof o1)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function o5(t,e){return t=(0,i.getModularInstance)(t),e=(0,i.getModularInstance)(e),t instanceof o0&&e instanceof o0&&t.firestore===e.firestore&&tR(t._query,e._query)&&t.converter===e.converter/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var o6=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new r2(this,"async_queue_retry"),this.Ic=function(){var e=r0();e&&d("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=r0();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=r0();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new nc;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},t.prototype.bc=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t,e=this;return(0,r.__generator)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!ny(t=n.sent()))throw t;return d("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.bc()}),n.label=5;case 5:return[2]}})})},t.prototype.Rc=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){var n;throw e.yc=t,e.gc=!1,p("INTERNAL UNHANDLED ERROR: ",(n=t.message||"",t.stack&&(n=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),n)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=iS.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&g()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return(0,r.__awaiter)(this,void 0,void 0,function(){var t;return(0,r.__generator)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()})},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function o8(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)}var o7=function(){function t(){this._progressObserver={},this._taskCompletionResolver=new nc,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},t}(),o9=-1,st=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new o6,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,r.__extends)(e,t),e.prototype._terminate=function(){return this._firestoreClient||sn(this),this._firestoreClient.terminate()},e}(oJ);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function se(t){return t._firestoreClient||sn(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function sn(t){var e,n,r,i,o=t._freezeSettings(),s=(e=t._databaseId,n=(null===(i=t._app)||void 0===i?void 0:i.options.appId)||"",r=t._persistenceKey,new oO(e,n,r,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,o.useFetchStreams));t._firestoreClient=new oI(t._credentials,t._queue,s)}function sr(t,e,n){var i=this,o=new nc;return t.asyncQueue.enqueue(function(){return(0,r.__awaiter)(i,void 0,void 0,function(){var i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,oE(t,n)];case 1:return r.sent(),[4,oT(t,e)];case 2:return r.sent(),o.resolve(),[3,4];case 3:var s;if(!("FirebaseError"===(s=i=r.sent()).name?s.code===c.FAILED_PRECONDITION||s.code===c.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&s instanceof DOMException)||22===s.code||20===s.code||11===s.code))throw i;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i),o.reject(i),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function si(t){if(t._initialized||t._terminated)throw new h(c.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var so=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new h(c.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new x(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),ss=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(C.fromBase64String(e))}catch(t){throw new h(c.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},t.fromUint8Array=function(e){return new t(C.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),sa=function(t){this._methodName=t},su=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new h(c.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new h(c.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return _(this._lat,t._lat)||_(this._long,t._long)},t}(),sc=/^__.*__$/,sh=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new t5(t,this.data,this.fieldMask,e,this.fieldTransforms):new t3(t,this.data,e,this.fieldTransforms)},t}(),sl=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new t5(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw g()}}var sd=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return sL(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(sf(this.Nc)&&sc.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),sp=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||r1(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new sd({Nc:t,methodName:e,qc:n,path:x.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function sy(t){var e=t._freezeSettings(),n=r1(t._databaseId);return new sp(t._databaseId,!!e.ignoreUndefinedProperties,n)}function sm(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);sx("Data must be an object, but it was:",s,r);var a,u,l=sD(r,s);if(o.merge)a=new k(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var f=[],d=0,p=o.mergeFields;d<p.length;d++){var y=sk(e,p[d],n);if(!s.contains(y))throw new h(c.INVALID_ARGUMENT,"Field '"+y+"' is specified in your field mask but missing from your input data.");sO(f,y)||f.push(y)}a=new k(f),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new sh(new te(l),a,u)}var sg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw 1===t.Nc?t.Lc(this._methodName+"() can only appear at the top level of your update data"):t.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(sa);function sv(t,e,n){return new sd({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var s_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype._toFieldTransform=function(t){return new t$(t.path,new tj)},e.prototype.isEqual=function(t){return t instanceof e},e}(sa),sw=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,r.__extends)(e,t),e.prototype._toFieldTransform=function(t){var e=sv(this,t,!0),n=this.Kc.map(function(t){return sN(t,e)}),r=new tK(n);return new t$(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(sa),sb=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,r.__extends)(e,t),e.prototype._toFieldTransform=function(t){var e=sv(this,t,!0),n=this.Kc.map(function(t){return sN(t,e)}),r=new tG(n);return new t$(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(sa),sI=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return(0,r.__extends)(e,t),e.prototype._toFieldTransform=function(t){var e=new tW(t.R,tq(t.R,this.Qc));return new t$(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(sa);function sE(t,e,n,r){var o=t.Uc(1,e,n);sx("Data must be an object, but it was:",o,r);var s=[],a=te.empty();T(r,function(t,r){var u=sR(e,t,n);r=(0,i.getModularInstance)(r);var c=o.Oc(u);if(r instanceof sg)s.push(u);else{var h=sN(r,c);null!=h&&(s.push(u),a.set(u,h))}});var u=new k(s);return new sl(a,u,o.fieldTransforms)}function sT(t,e,n,r,o,s){var a=t.Uc(1,e,n),u=[sk(e,r,n)],l=[o];if(s.length%2!=0)throw new h(c.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var f=0;f<s.length;f+=2)u.push(sk(e,s[f])),l.push(s[f+1]);for(var d=[],p=te.empty(),y=u.length-1;y>=0;--y)if(!sO(d,u[y])){var m=u[y],g=l[y];g=(0,i.getModularInstance)(g);var v=a.Oc(m);if(g instanceof sg)d.push(m);else{var _=sN(g,v);null!=_&&(d.push(m),p.set(m,_))}}var w=new k(d);return new sl(p,w,a.fieldTransforms)}function sS(t,e,n,r){return void 0===r&&(r=!1),sN(n,t.Uc(r?4:3,e))}function sN(t,e){if(sA(t=(0,i.getModularInstance)(t)))return sx("Unsupported field value:",e,t),sD(t,e);if(t instanceof sa)return function(t,e){if(!sf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0;i<t.length;i++){var o=sN(t[i],e.Mc(r));null==o&&(o={nullValue:"NULL_VALUE"}),n.push(o),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,i.getModularInstance)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return tq(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=b.fromDate(t);return{timestampValue:ex(e.R,n)}}if(t instanceof b)return n=new b(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ex(e.R,n)};if(t instanceof su)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ss)return{bytesValue:ek(e.R,t._byteString)};if(t instanceof oZ){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:eR(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+oH(t))}(t,e)}function sD(t,e){var n={};return S(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):T(t,function(t,r){var i=sN(r,e.kc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function sA(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof b||t instanceof su||t instanceof ss||t instanceof oZ||t instanceof sa)}function sx(t,e,n){if(!sA(n)||!("object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n)))){var r=oH(n);throw"an object"===r?e.Lc(t+" a custom object"):e.Lc(t+" "+r)}}function sk(t,e,n){if((e=(0,i.getModularInstance)(e))instanceof so)return e._internalPath;if("string"==typeof e)return sR(t,e);throw sL("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var sC=RegExp("[~\\*/\\[\\]]");function sR(t,e,n){if(e.search(sC)>=0)throw sL("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(so.bind.apply(so,(0,r.__spreadArray)([void 0],e.split(".")))))._internalPath}catch(r){throw sL("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function sL(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new h(c.INVALID_ARGUMENT,(a+=". ")+t+u)}function sO(t,e){return t.some(function(t){return t.isEqual(e)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sP=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new oZ(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new sF(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(sM("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),sF=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(sP);function sM(t,e){return"string"==typeof e?sR(t,e):e instanceof so?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var sV=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),sq=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return(0,r.__extends)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new sU(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(sM("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(sP),sU=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(sq),sB=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new sV(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new sU(n._firestore,n._userDataWriter,r.key,r,new sV(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new h(c.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new sU(t._firestore,t._userDataWriter,e.doc.key,e.doc,new sV(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new sU(t._firestore,t._userDataWriter,e.doc.key,e.doc,new sV(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return g()}}(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function sj(t,e){return t instanceof sq&&e instanceof sq?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof sB&&e instanceof sB&&t._firestore===e._firestore&&o5(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sK(t){if(tS(t)&&0===t.explicitOrderBy.length)throw new h(c.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var sQ=function(){};function sG(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++)t=e[r]._apply(t);return t}var sz=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return(0,r.__extends)(e,t),e.prototype._apply=function(t){var e,n,r=sy(t.firestore),i=function(t,e,n,r,i,o,s){if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new h(c.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){sZ(s,o);for(var a,u=[],l=0;l<s.length;l++){var f=s[l];u.push(sJ(r,t,f))}a={arrayValue:{values:u}}}else a=sJ(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||sZ(s,o),a=sS(n,"where",s,"in"===o||"not-in"===o);var d=tu.create(i,o,a);return function(t,e){if(e.g()){var n=tD(t);if(null!==n&&!n.isEqual(e.field))throw new h(c.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=tN(t);null!==r&&s0(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new h(c.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new h(c.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,d),d}(t._query,0,r,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new o0(t.firestore,t.converter,(n=(e=t._query).filters.concat([i]),new tI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)))},e}(sQ),sW=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return(0,r.__extends)(e,t),e.prototype._apply=function(t){var e,n,r=function(t,e,n){if(null!==t.startAt)throw new h(c.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new h(c.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new t_(e,n);return function(t,e){if(null===tN(t)){var n=tD(t);null!==n&&s0(t,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new o0(t.firestore,t.converter,(n=(e=t._query).explicitOrderBy.concat([r]),new tI(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))},e}(sQ),sH=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,r.__extends)(e,t),e.prototype._apply=function(t){return new o0(t.firestore,t.converter,tC(t._query,this.Hc,this.Jc))},e}(sQ),sY=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,r.__extends)(e,t),e.prototype._apply=function(t){var e,n=sX(t,this.type,this.Yc,this.Xc);return new o0(t.firestore,t.converter,(e=t._query,new tI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,n,e.endAt)))},e}(sQ),s$=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,r.__extends)(e,t),e.prototype._apply=function(t){var e,n=sX(t,this.type,this.Yc,this.Xc);return new o0(t.firestore,t.converter,(e=t._query,new tI(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,n)))},e}(sQ);function sX(t,e,n,r){if(n[0]=(0,i.getModularInstance)(n[0]),n[0]instanceof sP)return function(t,e,n,r,i){if(!r)throw new h(c.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=tx(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(H(e,r.key));else{var l=r.data.field(u.field);if(F(l))throw new h(c.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===l){var f=u.field.canonicalString();throw new h(c.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+f+"' (used as the orderBy) does not exist.")}o.push(l)}}return new tg(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var o=sy(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new h(c.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var l=i[u];if(s[u].field.isKeyField()){if("string"!=typeof l)throw new h(c.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof l);if(!tA(t)&&-1!==l.indexOf("/"))throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+l+"' contains a slash.");var f=t.path.child(D.fromString(l));if(!B.isDocumentKey(f))throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+f+"' is not because it contains an odd number of segments.");var d=new B(f);a.push(H(e,d))}else{var p=sS(n,r,l);a.push(p)}}return new tg(a,o)}(t._query,t.firestore._databaseId,o,e,n,r)}function sJ(t,e,n){if("string"==typeof(n=(0,i.getModularInstance)(n))){if(""===n)throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!tA(e)&&-1!==n.indexOf("/"))throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(D.fromString(n));if(!B.isDocumentKey(r))throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return H(t,new B(r))}if(n instanceof oZ)return H(t,n._key);throw new h(c.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+oH(n)+".")}function sZ(t,e){if(!Array.isArray(t)||0===t.length)throw new h(c.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new h(c.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function s0(t,e,n){if(!n.isEqual(e))throw new h(c.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var s1=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),j(t)){case 0:return null;case 1:return t.booleanValue;case 2:return O(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(P(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw g()}},t.prototype.convertObject=function(t,e){var n=this,r={};return T(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new su(O(t.latitude),O(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){var n=e.mapValue.fields.__previous_value__;return F(n)?t(n):n}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(M(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=L(t);return new b(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=D.fromString(t);eX(n)||g();var r=new oP(n.get(1),n.get(3)),i=new B(n.popFirst(5));return r.isEqual(e)||p("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var s4=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,r.__extends)(e,t),e.prototype.convertBytes=function(t){return new ss(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new oZ(this.firestore,null,e)},e}(s1),s3=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=sy(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=s5(t,this._firestore),i=s2(r.converter,e,n),o=sm(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,tJ.none())),this},t.prototype.update=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];this._verifyNotCommitted();var s,a=s5(t,this._firestore);return s="string"==typeof(e=(0,i.getModularInstance)(e))||e instanceof so?sT(this._dataReader,"WriteBatch.update",a._key,e,n,r):sE(this._dataReader,"WriteBatch.update",a._key,e),this._mutations.push(s.toMutation(a._key,tJ.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=s5(t,this._firestore);return this._mutations=this._mutations.concat(new ee(e._key,tJ.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new h(c.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s5(t,e){if((t=(0,i.getModularInstance)(t)).firestore!==e)throw new h(c.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var s6=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,r.__extends)(e,t),e.prototype.convertBytes=function(t){return new ss(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new oZ(this.firestore,null,e)},e}(s1);function s8(t,e,n){t=oY(t,oZ);var r=oY(t.firestore,st),i=s2(t.converter,e,n);return at(r,[sm(sy(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,tJ.none())])}function s7(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];t=oY(t,oZ);var s=oY(t.firestore,st),a=sy(s);return at(s,[("string"==typeof(e=(0,i.getModularInstance)(e))||e instanceof so?sT(a,"updateDoc",t._key,e,n,r):sE(a,"updateDoc",t._key,e)).toMutation(t._key,tJ.exists(!0))])}function s9(t){for(var e,n,o,s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];t=(0,i.getModularInstance)(t);var u={includeMetadataChanges:!1},c=0;"object"!=typeof s[0]||o8(s[c])||(u=s[c],c++);var h,l,f,d={includeMetadataChanges:u.includeMetadataChanges};if(o8(s[c])){var p=s[c];s[c]=null===(e=p.next)||void 0===e?void 0:e.bind(p),s[c+1]=null===(n=p.error)||void 0===n?void 0:n.bind(p),s[c+2]=null===(o=p.complete)||void 0===o?void 0:o.bind(p)}if(t instanceof oZ)l=oY(t.firestore,st),f=tE(t._key.path),h={next:function(e){s[c]&&s[c](ae(l,t,e))},error:s[c+1],complete:s[c+2]};else{var y=oY(t,o0);l=oY(y.firestore,st),f=y._query;var m=new s6(l);h={next:function(t){s[c]&&s[c](new sB(l,m,y,t))},error:s[c+1],complete:s[c+2]},sK(t._query)}return function(t,e,n,i){var o=this,s=new ov(i),a=new iM(e,s,n);return t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(o,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e=iR,[4,oC(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}})})}),function(){s.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(o,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e=iL,[4,oC(t)];case 1:return[2,e.apply(void 0,[n.sent(),a])]}})})})}}(se(l),f,d,h)}function at(t,e){return function(t,e){var n=this,i=new nc;return t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(n,void 0,void 0,function(){var n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=iX,[4,ok(t)];case 1:return[2,n.apply(void 0,[r.sent(),e,i])]}})})}),i.promise}(se(t),e)}function ae(t,e,n){var r=n.docs.get(e._key),i=new s6(t);return new sq(t,i,e._key,r,new sV(n.hasPendingWrites,n.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var an=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,r.__extends)(e,t),e.prototype.get=function(e){var n=this,r=s5(e,this._firestore),i=new s6(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new sq(n._firestore,i,r._key,t._document,new sV(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=sy(t)}return t.prototype.get=function(t){var e=this,n=s5(t,this._firestore),r=new s4(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return g();var i=t[0];if(i.isFoundDocument())return new sP(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new sP(e._firestore,r,n._key,null,n.converter);throw g()})},t.prototype.set=function(t,e,n){var r=s5(t,this._firestore),i=s2(r.converter,e,n),o=sm(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var s,a=s5(t,this._firestore);return s="string"==typeof(e=(0,i.getModularInstance)(e))||e instanceof so?sT(this._dataReader,"Transaction.update",a._key,e,n,r):sE(this._dataReader,"Transaction.update",a._key,e),this._transaction.update(a._key,s),this},t.prototype.delete=function(t){var e=s5(t,this._firestore);return this._transaction.delete(e._key),this},t}());/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ar(){if("undefined"==typeof Uint8Array)throw new h(c.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ai(){if("undefined"==typeof atob)throw new h(c.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ao=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return ai(),new t(ss.fromBase64String(e))},t.fromUint8Array=function(e){return ar(),new t(ss.fromUint8Array(e))},t.prototype.toBase64=function(){return ai(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return ar(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),as=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){var n,r,i,o,s;return n=t._delegate,r={forceOwnership:e},si(n=oY(n,st)),i=se(n),o=n._freezeSettings(),sr(i,s=new om,new op(s,o.cacheSizeBytes,null==r?void 0:r.forceOwnership))},t.prototype.enableMultiTabIndexedDbPersistence=function(t){var e,n,r,i;return si(e=oY(e=t._delegate,st)),n=se(e),r=e._freezeSettings(),sr(n,i=new om,new oy(i,r.cacheSizeBytes))},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new h(c.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new nc;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,r.__awaiter)(e,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return nf.yt()?(e=t+"main",[4,nf.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}})})}(rd(t._databaseId,t._persistenceKey))];case 1:return i.sent(),n.resolve(),[3,3];case 2:return e=i.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),aa=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof oP||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||y("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var o,s,a,u=(t=oY(t,oJ))._getSettings();if("firestore.googleapis.com"!==u.host&&u.host!==e&&y("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},u),{host:e+":"+n,ssl:!1})),r.mockUserToken){if("string"==typeof r.mockUserToken)s=r.mockUserToken,a=rM.MOCK_USER;else{s=(0,i.createMockUserToken)(r.mockUserToken,null===(o=t._app)||void 0===o?void 0:o.options.projectId);var l=r.mockUserToken.sub||r.mockUserToken.user_id;if(!l)throw new h(c.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new rM(l)}t._credentials=new oq(new oM(s,a))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,r.__awaiter)(e,void 0,void 0,function(){var e,n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,oD(t)];case 1:return e=r.sent(),[4,ox(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),n.Or.delete(0),r9(n))]}})})})}(se(oY(this._delegate,st)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,r.__awaiter)(e,void 0,void 0,function(){var e,n;return(0,r.__generator)(this,function(i){switch(i.label){case 0:return[4,oD(t)];case 1:return e=i.sent(),[4,ox(t)];case 2:return n=i.sent(),[2,(e.setNetworkEnabled(!1),function(t){return(0,r.__awaiter)(this,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return(e=t).Or.add(0),[4,it(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(se(oY(this._delegate,st)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&oG("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new nc;return t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(e,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return e=i4,[4,ok(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(se(oY(this._delegate,st)))},t.prototype.onSnapshotsInSync=function(t){var e;return function(t,e){var n=this,i=new ov(e);return t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(n,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e=function(t,e){t.Gr.add(e),e.next()},[4,oC(t)];case 1:return[2,e.apply(void 0,[n.sent(),i])]}})})}),function(){i.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(n,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e=function(t,e){t.Gr.delete(e)},[4,oC(t)];case 1:return[2,e.apply(void 0,[n.sent(),i])]}})})})}}(se(oY(this._delegate,st)),o8(t)?t:{next:t})},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new h(c.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new aI(this,o2(this._delegate,t))}catch(t){throw ap(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new ad(this,o4(this._delegate,t))}catch(t){throw ap(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new a_(this,function(t,e){if(t=oY(t,oJ),oK("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new h(c.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new o0(t,null,new tI(D.emptyPath(),e))}(this._delegate,t))}catch(t){throw ap(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e,n=this;return function(t,e){var n=this,i=new nc;return t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(n,void 0,void 0,function(){var n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return[4,oN(t).then(function(t){return t.datastore})];case 1:return n=r.sent(),new ob(t.asyncQueue,n,e,i).run(),[2]}})})}),i.promise}(se(e=this._delegate),function(r){var i;return i=new an(e,r),t(new ah(n,i))})},t.prototype.batch=function(){var t=this;return se(this._delegate),new al(new s3(this._delegate,function(e){return at(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new h(c.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new h(c.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),au=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,r.__extends)(e,t),e.prototype.convertBytes=function(t){return new ao(new ss(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return ad.eu(e,this.firestore,null)},e}(s1);function ac(t){l.setLogLevel(t)}var ah=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new au(t)}return t.prototype.get=function(t){var e=this,n=oY(t,oZ);return this._delegate.get(n).then(function(t){return new ag(e._firestore,new sq(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=oY(t,oZ);return n?(oQ("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=oY(t,oZ);return 2==arguments.length?this._delegate.update(a,e):(i=this._delegate).update.apply(i,(0,r.__spreadArray)([a,e,n],o)),this},t.prototype.delete=function(t){var e=oY(t,oZ);return this._delegate.delete(e),this},t}(),al=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=oY(t,oZ);return n?(oQ("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=oY(t,oZ);return 2==arguments.length?this._delegate.update(a,e):(i=this._delegate).update.apply(i,(0,r.__spreadArray)([a,e,n],o)),this},t.prototype.delete=function(t){var e=oY(t,oZ);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),af=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new sU(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new av(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new au(e),n),i.set(n,o)),o},t}();af.su=new WeakMap;var ad=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new au(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new h(c.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new oZ(n._delegate,r,new B(e)))},t.eu=function(e,n,r){return new t(n,new oZ(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new aI(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new aI(this.firestore,o2(this._delegate,t))}catch(t){throw ap(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,i.getModularInstance)(t))instanceof oZ&&o3(this._delegate,t)},t.prototype.set=function(t,e){e=oQ("DocumentReference.set",e);try{return e?s8(this._delegate,t,e):s8(this._delegate,t)}catch(t){throw ap(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];try{return 1==arguments.length?s7(this._delegate,t):s7.apply(void 0,(0,r.__spreadArray)([this._delegate,t,e],n))}catch(t){throw ap(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){var t;return at(oY((t=this._delegate).firestore,st),[new ee(t._key,tJ.none())])},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ay(e),i=am(e,function(e){return new ag(t.firestore,new sq(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return s9(this._delegate,r,i)},t.prototype.get=function(t){var e,n,i,o,s,a,u,l,f=this;return("cache"===(null==t?void 0:t.source)?(e=oY(e=this._delegate,oZ),i=se(n=oY(e.firestore,st)),o=new s6(n),(function(t,e){var n=this,i=new nc;return t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(n,void 0,void 0,function(){var n;return(0,r.__generator)(this,function(o){switch(o.label){case 0:return n=function(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,t.persistence.runTransaction("read document","readonly",function(n){return t.Mn.mn(n,e)})];case 1:return(i=r.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new h(c.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=iN(r.sent(),"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,oA(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,i])]}})})}),i.promise})(i,e._key).then(function(t){return new sq(n,o,e._key,t,new sV(null!==t&&t.hasLocalMutations,!0),e.converter)})):"server"===(null==t?void 0:t.source)?(s=oY(s=this._delegate,oZ),oR(se(a=oY(s.firestore,st)),s._key,{source:"server"}).then(function(t){return ae(a,s,t)})):(u=oY(u=this._delegate,oZ),oR(se(l=oY(u.firestore,st)),u._key).then(function(t){return ae(l,u,t)}))).then(function(t){return new ag(f.firestore,new sq(f.firestore._delegate,f._userDataWriter,t._key,t._document,t.metadata,f._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(af.nu(this.firestore,e)):this._delegate.withConverter(null))},t}();function ap(t,e,n){return t.message=t.message.replace(e,n),t}function ay(t){for(var e=0;e<t.length;e++){var n=t[e];if("object"==typeof n&&!o8(n))return n}return{}}function am(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=o8(t[0])?t[0]:o8(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var ag=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new ad(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return sj(this._delegate,t._delegate)},t}(),av=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,r.__extends)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(ag),a_=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new au(t)}return t.prototype.where=function(e,n,r){try{var i;return new t(this.firestore,sG(this._delegate,(i=sM("where",e),new sz(i,n,r))))}catch(t){throw ap(t,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{var r,i,o;return new t(this.firestore,sG(this._delegate,(r=n,void 0===r&&(r="asc"),i=r,o=sM("orderBy",e),new sW(o,i))))}catch(t){throw ap(t,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,sG(this._delegate,(o$("limit",e),new sH("limit",e,"F"))))}catch(t){throw ap(t,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,sG(this._delegate,(o$("limitToLast",e),new sH("limitToLast",e,"L"))))}catch(t){throw ap(t,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,sG(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sY("startAt",t,!0)}).apply(void 0,e)))}catch(t){throw ap(t,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,sG(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sY("startAfter",t,!1)}).apply(void 0,e)))}catch(t){throw ap(t,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,sG(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new s$("endBefore",t,!0)}).apply(void 0,e)))}catch(t){throw ap(t,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,sG(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new s$("endAt",t,!1)}).apply(void 0,e)))}catch(t){throw ap(t,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return o5(this._delegate,t._delegate)},t.prototype.get=function(t){var e,n,i,o,s,a,u,c,h,l,f,d,p=this;return("cache"===(null==t?void 0:t.source)?(e=oY(e=this._delegate,o0),i=se(n=oY(e.firestore,st)),o=new s6(n),(function(t,e){var n=this,i=new nc;return t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(n,void 0,void 0,function(){var n;return(0,r.__generator)(this,function(o){switch(o.label){case 0:return n=function(t,e,n){return(0,r.__awaiter)(this,void 0,void 0,function(){var i,o,s,a;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,rT(t,e,!0)];case 1:return a=r.sent(),o=(i=new iQ(e,a.Bn))._o(a.documents),s=i.applyChanges(o,!1),n.resolve(s.snapshot),[3,3];case 2:return a=iN(r.sent(),"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,oA(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,i])]}})})}),i.promise})(i,e._query).then(function(t){return new sB(n,o,e,t)})):"server"===(null==t?void 0:t.source)?(s=oY(s=this._delegate,o0),u=se(a=oY(s.firestore,st)),c=new s6(a),oL(u,s._query,{source:"server"}).then(function(t){return new sB(a,c,s,t)})):(h=oY(h=this._delegate,o0),f=se(l=oY(h.firestore,st)),d=new s6(l),sK(h._query),oL(f,h._query).then(function(t){return new sB(l,d,h,t)}))).then(function(t){return new ab(p.firestore,new sB(p.firestore._delegate,p._userDataWriter,p._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=ay(e),i=am(e,function(e){return new ab(t.firestore,new sB(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return s9(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(af.nu(this.firestore,e)):this._delegate.withConverter(null))},t}(),aw=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new av(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),ab=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new a_(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new av(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new aw(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new av(n._firestore,r))})},t.prototype.isEqual=function(t){return sj(this._delegate,t._delegate)},t}(),aI=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,r.__extends)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new ad(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new ad(this.firestore,void 0===t?o4(this._delegate):o4(this._delegate,t))}catch(t){throw ap(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e,n,r,i,o=this;return(n=oY((e=this._delegate).firestore,st),r=o4(e),i=s2(e.converter,t),at(n,[sm(sy(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,tJ.exists(!1))]).then(function(){return r})).then(function(t){return new ad(o.firestore,t)})},e.prototype.isEqual=function(t){return o3(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(af.nu(this.firestore,t)):this._delegate.withConverter(null))},e}(a_),aE=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(so.bind.apply(so,(0,r.__spreadArray)([void 0],t)))}return t.documentId=function(){return new t(x.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,i.getModularInstance)(t))instanceof so&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),aT=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new s_("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new sg("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sw("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sb("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=new sI("increment",e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aS(t){var e,n,i;return n=se(e=oY(e=this._delegate,st)),i=new o7,function(t,e,n,i){var o,s,a=this,u=(o=r1(e),s=function(t,e){if(t instanceof Uint8Array)return og(t,e);if(t instanceof ArrayBuffer)return og(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?(new TextEncoder).encode(n):n),new o_(s,o));t.asyncQueue.enqueueAndForget(function(){return(0,r.__awaiter)(a,void 0,void 0,function(){var e;return(0,r.__generator)(this,function(n){switch(n.label){case 0:return e=of,[4,ok(t)];case 1:return e.apply(void 0,[n.sent(),u,i]),[2]}})})})}(n,e._databaseId,t,i),i}function aN(t){var e,n=this;return(function(t,e){var n=this;return t.asyncQueue.enqueue(function(){return(0,r.__awaiter)(n,void 0,void 0,function(){var n;return(0,r.__generator)(this,function(r){switch(r.label){case 0:return n=function(t,e){return t.persistence.runTransaction("Get named query","readonly",function(n){return t.Ke.getNamedQuery(n,e)})},[4,oA(t)];case 1:return[2,n.apply(void 0,[r.sent(),e])]}})})})})(se(e=oY(e=this._delegate,st)),t).then(function(t){return t?new o0(e,null,t.query):null}).then(function(t){return t?new a_(n,t):null})}}}]);